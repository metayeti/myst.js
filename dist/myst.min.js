/* myst.js 0.9.3
 * (c) 2020 Danijel Durakovic
 * MIT License */
"use strict";var myst={},C_NULL=void 0,C_EMPTYF=function(){},C_VIEW_DEFAULT=0,C_VIEW_CENTER=1,C_VIEW_SCALE_FIT=2,C_VIEW_SCALE_STRETCH=3,C_VIEW_EXPAND=4;myst.compose=function(){if(Object.assign)return Object.assign.apply(null,arguments);for(var t=arguments[0],e=arguments.length,i=1;i<e;++i){var n=arguments[i];if(n)for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])}return t},myst.clamp=function(t,e,i){return t<=e?e:i<=t?i:t},myst.getRandomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},myst.coinFlip=function(){return 1==Math.floor(2*Math.random())},myst.shuffle=function(t){for(var e=t.length;--e;){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}},myst.choose=function(t){if(t instanceof Array)return t[Math.floor(Math.random()*t.length)]},myst.pointInRect=function(t,e,i,n,s,o){return i<=t&&t<i+s&&n<=e&&e<n+o},myst.pointInCircle=function(t,e,i,n,s){return Math.pow(t-i,2)+Math.pow(e-n,2)<Math.pow(s,2)},myst.linesIntersect=function(t,e,i,n,s,o,a,r){function h(t,e,i,n,s,o){return(n-e)*(s-t)<(o-e)*(i-t)}return h(t,e,s,o,a,r)!=h(i,n,s,o,a,r)&&h(t,e,i,n,s,o)!=h(t,e,i,n,a,r)},myst.pointToPointDistance=function(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))},myst.pointToLineDistance=function(t,e,i,n,s,o){var a=s-i,s=o-n,o=Math.pow(a,2)+Math.pow(s,2);if(0==o)return 0;o=Math.min(1,Math.max(0,(a*(t-i)+s*(e-n))/o)),a=i+o*a,s=n+o*s;return Math.sqrt(Math.pow(t-a,2)+Math.pow(e-s,2))},myst.movePoint=function(t,e,i,n,s){i=180*Math.atan2(n-e,i-t)/Math.PI;return[t+Math.floor(Math.cos(i*Math.PI/180)*s),e+Math.floor(Math.sin(i*Math.PI/180)*s)]},myst.rotatePoint=function(t,e,i,n,s){return s*=Math.PI/180,t-=i,e-=n,[Math.floor(t*Math.cos(s)-e*Math.sin(s))+i,Math.floor(e*Math.cos(s)+t*Math.sin(s))+n]},myst.iter=function(t,e){for(var i in t){var n=t[i];!Object.prototype.hasOwnProperty.call(t,i)||n instanceof Function||e(i,n)}},myst.applyToGroup=function(t,i,n){void 0!==n&&(n=n instanceof Array?n:[n]),myst.iter(t,function(t,e){e[i]instanceof Function&&e[i].apply(e,n)})},myst.getFilenameExtension=function(t){return t.split(".").pop().toLowerCase()},myst.Grid2D=function(i,n,s){this.width=i,this.height=n,this.data=new Array(i*n),s=void 0===s?0:s,this.clear=function(){for(var t=i*n,e=0;e<t;++e)this.data[e]=s},this.get=function(t,e){return this.data[e*this.width+t]},this.set=function(t,e,i){this.data[e*this.width+t]=i}},myst.Timer=function(t){(t=t||1)<1&&(t=1);var e=0;this.ticked=!1,this.run=function(){return t<=(e+=1)?(e-=t,this.ticked=!0):this.ticked=!1},this.reset=function(){e=0,this.ticked=!1}},myst.Tween=function(n,s,o,a,r,h,c,t){if(isNaN(o)||isNaN(s)||isNaN(n)||o<=0)throw new Error("Erroneous parameters for Tween.");h instanceof Function||(h=myst.ease.linear);var f=null,u=15,l=a instanceof Function,y=r instanceof Function,d=c instanceof Function,e=t instanceof Function;function k(t){var e=t/o,i=n+h(e)*(s-n);d&&(i=c(i)),l&&a(i),f=e<1?setTimeout(function(){k(t+u)},u):(l&&a(s),y&&r(),clearTimeout(f),null)}this.stop=function(){clearTimeout(f),f=null},this.start=function(){null===f&&k(0)},this.restart=function(){null!==f&&clearTimeout(f),k(0)},this.finish=function(){null!==f&&(clearTimeout(f),f=null,a instanceof Function&&a(s),e&&t())},this.isActive=function(){return null!==f}},myst.ease={linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return t<.5?2*t*t:(4-2*t)*t-1},backIn:function(t){return t*t*t-.8*t*Math.sin(t*Math.PI)},backOut:function(t){return t*t*t- -1.2*t*Math.sin(t*Math.PI)}},myst.AssetLoader=function(){var h=this,c={};function e(h){this.get=function(){for(var t,e,i,n,s=arguments.length,o={},a=0,r=0;r<s;r++)if("string"==typeof arguments[r])for(t=arguments[r].trim().replace(/,/g,"").split(/\s+/),n=0;n<t.length;n++)e=t[n],i=h[e],o[e]=i,a++;return 1==a?o[Object.keys(o)[0]]:1<a?o:void 0}}this.handler={},this.handler.graphics=function(t,e){var i=new Image;i.src=t,i.addEventListener("load",function(){e(i)})},this.handler.data=function(t,e){var i=new XMLHttpRequest;i.open("get",t,!0),i.send(null),i.onreadystatechange=function(){var t;4===i.readyState&&200===i.status&&(t=i.responseText,t=JSON.parse(t),e(t))}},this.handler.text=function(t,e){var i=new XMLHttpRequest;i.open("get",t,!0),i.send(null),i.onreadystatechange=function(){var t;4===i.readyState&&200===i.status&&(t=i.responseText,e(t))}},this.load=function(t){var e=t.assets;if(e){var s=t.done||C_EMPTYF,o=t.progress||C_EMPTYF,a=0,r=0;return myst.iter(e,function(t,e){myst.iter(e,function(){r++})}),myst.iter(e,function(i,t){var n=h.handler[i];n instanceof Function&&(c[i]||(c[i]={}),myst.iter(t,function(e,t){n(t,function(t){c[i][e]=t,o(++a,r),a===r&&s()})}))}),c}},this.get=function(){for(var t,e,i,n,s=arguments.length,o={},a=0,r=0;r<s;r++)if("string"==typeof arguments[r])for(t=arguments[r].trim().replace(/,/g,"").split(/\s+/),n=0;n<t.length;n++)2===(e=t[n].split(".")).length&&(i=e[0],e=e[1],i=c[i]?c[i][e]:void 0,o[e]=i,a++);return 1==a?o[Object.keys(o)[0]]:1<a?o:void 0},this.from=function(t){if("string"==typeof t)return new e(c[t.trim()])},this.getResources=function(){return c}},myst.Input=function(a){var r=0,h=1,c=a.getSurface().getCanvas(),f=c.parentElement;function u(t,e){var i,n;switch(a.getViewMode()){case C_VIEW_SCALE_FIT:i=n=c.offsetWidth<f.offsetWidth?c.height/f.offsetHeight:c.width/f.offsetWidth;break;case C_VIEW_SCALE_STRETCH:i=c.width/f.offsetWidth,n=c.height/f.offsetHeight;break;case C_VIEW_EXPAND:case C_VIEW_CENTER:case C_VIEW_DEFAULT:i=n=1}var s=c.getBoundingClientRect(),o=(e===h?t.changedTouches[0]:t).clientX,t=(e===h?t.changedTouches[0]:t).clientY;return[Math.floor((o-s.left)*i),Math.floor((t-s.top)*n)]}var s={press:[],move:[],release:[]};function e(t,e){if(e.preventDefault&&e.preventDefault(),1===(e.which||e.button))for(var i=u(e,r),n=t.length;n--;){var s=t[n],o=s[0],s=s[1];s&&!s._active||o(i)}}function i(t,e){if(e.preventDefault&&e.preventDefault(),!(1<e.touches.length))for(var i=u(e,h),n=t.length;n--;){var s=t[n],o=s[0],s=s[1];s&&!s._active||o(i)}}function n(e){this.bindTo=function(t){t&&(e[1]=t)}}c.addEventListener("mousedown",function(t){e(s.press,t)}),c.addEventListener("touchstart",function(t){i(s.press,t)}),window.addEventListener("mousemove",function(t){!function(t,e){e.preventDefault&&e.preventDefault();for(var i=u(e,r),n=t.length;n--;){var s=t[n],o=s[0],s=s[1];s&&!s._active||o(i)}}(s.move,t)}),window.addEventListener("touchmove",function(t){i(s.move,t)}),window.addEventListener("mouseup",function(t){e(s.release,t)}),window.addEventListener("touchend",function(t){i(s.release,t)}),this.on=function(t,e,i){t=s[t],i=[e,C_NULL,i];return t.push(i),new n(i)},this.off=function(t,e){if(t||e)if(e){var i=s[t];if(i)for(var n=i.length;n--;)i[n][2]===e&&i.splice(n,1)}else s[t]=[];else s={press:[],move:[],release:[]}}},myst.KeyInput=function(){var i=this,n=[],s=[];function o(t,e){n.push({type:t,keycode:e})}this.KEYDOWN=0,this.KEYUP=1,document.addEventListener("keydown",function(t){var e=t.keyCode||t.which;e!==i.keyBackspace&&e!==i.keyAlt||t.preventDefault(),s[e]||(s[e]=!0,o(i.KEYDOWN,e))}),document.addEventListener("keyup",function(t){var e=t.keyCode||t.which;e!==i.keyBackspace&&e!==i.keyAlt||t.preventDefault(),s[e]&&(delete s[e],o(i.KEYUP,e))}),window.onblur=function(){n=[],s=[]},this.clear=function(){n=[],s=[]},this.pollEvent=function(){return n.shift()},this.isAlphanumeric=function(t){return!!(47<t&&t<58||64<t&&t<91||96<t&&t<123)},this.getCharacter=function(t){return String.fromCharCode(t)},this.isKeyDown=function(t){t=s[t];return void 0!==t&&t},myst.compose(this,{keyCancel:3,keyHelp:6,keyBackspace:8,keyTab:9,keyClear:12,keyEnter:13,keyReturn:14,keyShift:16,keyControl:17,keyAlt:18,keyPause:19,keyCapsLock:20,keyEscape:27,keySpace:32,keyPageUp:33,keyPageDown:34,keyEnd:35,keyHome:36,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyPrintscreen:44,keyInsert:45,keyDelete:46,key0:48,key1:49,key2:50,key3:51,key4:52,key5:53,key6:54,key7:55,key8:56,key9:57,keySemicolon:59,keyEquals:61,keyA:65,keyB:66,keyC:67,keyD:68,keyE:69,keyF:70,keyG:71,keyH:72,keyI:73,keyJ:74,keyK:75,keyL:76,keyM:77,keyN:78,keyO:79,keyP:80,keyQ:81,keyR:82,keyS:83,keyT:84,keyU:85,keyV:86,keyW:87,keyX:88,keyY:89,keyZ:90,keyContextMenu:93,keyNumpad0:96,keyNumpad1:97,keyNumpad2:98,keyNumpad3:99,keyNumpad4:100,keyNumpad5:101,keyNumpad6:102,keyNumpad7:103,keyNumpad8:104,keyNumpad9:105,keyMultiply:106,keyAdd:107,keySeparator:108,keySubtract:109,keyDecimal:110,keyDivide:111,keyF1:112,keyF2:113,keyF3:114,keyF4:115,keyF5:116,keyF6:117,keyF7:118,keyF8:119,keyF9:120,keyF10:121,keyF11:122,keyF12:123,keyF13:124,keyF14:125,keyF15:126,keyF16:127,keyF17:128,keyF18:129,keyF19:130,keyF20:131,keyF21:132,keyF22:133,keyF23:134,keyF24:135,keyNumLock:144,keyScrollLock:145,keyComma:188,keyPeriod:190,keySlash:191,keyBackQuote:192,keyOpenBracket:219,keyBackSlash:220,keyCloseBracket:221,keyQuote:222,keyMeta:224})},myst.Configuration=function(e,i){var n=this;this.save=function(){localStorage.setItem(e,JSON.stringify(n))},this.load=function(){var t=localStorage.getItem(e),t=t?JSON.parse(t):i;myst.iter(n,function(t){delete n[t]}),myst.iter(t,function(t,e){n[t]=e})},this.remove=function(){localStorage.removeItem(e)}},myst.Render=function(_){this.ctx=_,this.setAlpha=function(t){void 0===t?t=1:t<=0?t=0:1<=t&&(t=1),_.globalAlpha=t},this.rotate=function(t,e){_.save(),_.translate(e[0],e[1]),_.rotate(t*Math.PI/180),_.translate(-e[0],-e[1])},this.restore=function(){_.restore()},this.line=function(t,e,i,n,s,o){s=void 0===s?"#fff":s,o=void 0===o?1:o,_.strokeStyle=s,_.lineWidth=o,_.beginPath(),_.moveTo(t,e),_.lineTo(i,n),_.stroke()},this.rect=function(t,e,i,n,s,o){s=void 0===s?"#fff":s,o=void 0===o?1:o,_.strokeStyle=s,_.lineWidth=o,_.strokeRect(t,e,i,n)},this.rectFill=function(t,e,i,n,s){s=void 0===s?"#fff":s,_.fillStyle=s,_.fillRect(t,e,i,n)},this.arc=function(t,e,i,n,s,o,a){o=void 0===o?"#fff":o,a=void 0===a?1:a,_.strokeStyle=o,_.lineWidth=a,_.arc(t,e,i,n,s),_.stroke()},this.circle=function(t,e,i,n,s){n=void 0===n?"#fff":n,s=void 0===s?1:s,_.strokeStyle=n,_.lineWidth=s,_.arc(t,e,i,0,2*Math.PI),_.stroke()},this.circleFill=function(t,e,i,n){n=void 0===n?"#fff":n,_.fillStyle=n,_.beginPath(),_.arc(t,e,i,0,2*Math.PI),_.fill(),_.closePath()},this.polygon=function(t,e){e=void 0===e?"#fff":e,_.fillStyle=e,_.beginPath(),_.moveTo(t[0][0],t[0][1]);for(var i=t.length,n=1;n<i;n++){var s=t[n];_.lineTo(s[0],s[1])}_.closePath(),_.fill()},this.graphics=function(t,e,i,n,s){void 0===n||void 0===s?_.drawImage(t,e,i):_.drawImage(t,e,i,n,s)},this.surface=function(t,e,i){_.drawImage(t.canvas,e,i)},this.tile=function(t,e,i,n,s,o,a){_.drawImage(t,o,a,n,s,e,i,n,s)},this.stretchTile=function(t,e,i,n,s,o,a,r,h){_.drawImage(t,o,a,n,s,e,i,r,h)},this.text=function(t,e,i,n,s,o){n=void 0===n?"#000":n,s=void 0===s?"left":s,o=void 0===o?"11px sans-serif":o,_.textBaseline="top",_.fillStyle=n,_.textAlign=s,_.font=o,_.fillText(t,e,i)},this.bmptext=function(t,e,i,n,s,o){void 0===s&&(s=0);var a,r,h=e.length,c=t.width,f=t.height,u=t.gfx,l=t.tilesH*s,y=0,d=t.varwidth,k=0,v=t.tileOffset;if(0<o){if(d){for(r=0;r<h;r++)p=e.charCodeAt(r)-32,y+=t.widths[p]+t.spacing;a=y,y=0}else a=h*c;k=1==o?Math.floor(a/2):a}for(r=0;r<h;r++){var m,p,g,w=(p=e.charCodeAt(r)-32)-v;d?(m=i+y,y+=t.widths[p]+t.spacing):m=i+r*(c+t.spacing),0!==p&&(g=c*(w%t.tilesPerRow),w=f*Math.floor(w/t.tilesPerRow)+l,_.drawImage(u,g,w,c,f,m-k,n,c,f))}}},myst.Font=function(t){if(this.gfx=t.graphics,this.width=t.size[0],this.height=t.size[1],this.spacing=void 0===t.spacing?2:t.spacing,this.tileOffset=void 0===t.offset?0:t.offset,this.tilesPerRow=Math.floor(this.gfx.width/this.width),this.tilesH=Math.ceil(95/this.tilesPerRow)*this.height,this.varwidth=void 0!==t.widths,this.varwidth)if(t.widths instanceof Array)this.widths=t.width;else{this.widths=[];for(var e=32;e<=126;e++){var i=String.fromCharCode(e),i=t.widths[i];this.widths.push(i||this.width)}}},myst.Surface=function(t){var e,i,n,s;(t=t||{}).fromCanvas?(s=t.fromCanvas,this.width=s.width,this.height=s.height):(n=void 0===t.width?100:t.width,t=void 0===t.height?100:t.height,s=document.createElement("canvas"),this.width=s.width=n,this.height=s.height=t),e=s.getContext("2d");var o=this.width,a=this.height;this.canvas=s,this.render=new myst.Render(e),this.cm_clear=function(){e.clearRect(0,0,this.width,this.height)},this.cm_fill=function(){e.fillStyle=i,e.fillRect(0,0,this.width,this.height)},this.clear=C_NULL,this.setDefaultClearMethod=function(){this.clear=this.cm_clear},this.setFillClearMethod=function(t){i=void 0===t?"#000":t,this.clear=this.cm_fill},this.getCanvas=function(){return s},this.resetSize=function(){this.resize(o,a)},this.resize=function(t,e){this.width=s.width=t,this.height=s.height=e},this.setDefaultClearMethod()},myst.State=function(t){t=t||{},this._initialized=!1,this._initState=function(t){this._initialized||(this._initialized=!0,this.surface=t,this.paint=t.render,this.init())},this._active=!1,this.surface=C_NULL,this.paint=C_NULL,this.isActive=function(){return this._active},this.init=t.init||C_EMPTYF,this.enter=t.enter||C_EMPTYF,this.exit=t.exit||C_EMPTYF,this.update=t.update||C_EMPTYF,this.draw=t.draw||C_EMPTYF},myst.Game=function(n){var a,r,s,o=this,h=C_NULL,c=C_NULL,f=Date.now()/1e3,u=0,l=1/60;function y(t){var e=Date.now()/1e3,i=e-f;for(f=e,u+=i=.25<i?.25:i;l<=u;)h.update(),u-=l;h.draw(),requestAnimationFrame(y)}function d(){h.draw(),requestAnimationFrame(d)}var e=C_VIEW_DEFAULT,i=C_NULL,t=C_NULL,k=20,v={init:{},update:{}};function m(){clearTimeout(t),t=setTimeout(i,k)}v.init[C_VIEW_CENTER]=function(){c.resetSize(),a.style.width=c.width+"px",a.style.height=c.height+"px",a.style.top="0",a.style.left="0",a.style.right="0",a.style.bottom="0",a.style.margin="auto"},v.update[C_VIEW_CENTER]=C_NULL,v.init[C_VIEW_SCALE_FIT]=function(){c.resetSize(),v.update[C_VIEW_SCALE_FIT](),a.style.top="0",a.style.left="0",a.style.right="0",a.style.bottom="0",a.style.margin="auto"},v.update[C_VIEW_SCALE_FIT]=function(){var t=c.width,e=c.height,i=r.offsetWidth,n=r.offsetHeight,s=t/e,o=n*s,n=i<o?(o=i)*(e/t):n;a.style.width=o+"px",a.style.height=n+"px"},v.init[C_VIEW_SCALE_STRETCH]=function(){c.resetSize(),a.style.width="100%",a.style.height="100%",a.style.top="0",a.style.left="0"},v.update[C_VIEW_SCALE_STRETCH]=C_NULL,v.init[C_VIEW_EXPAND]=function(){v.update[C_VIEW_EXPAND](),a.style.top="0",a.style.left="0"},v.update[C_VIEW_EXPAND]=function(){c.resize(r.offsetWidth,r.offsetHeight)},this.setState=function(t){h&&(h._active=!1,h.exit()),(h=t)._initialized||h._initState(c),h._active=!0,h.enter()},this.getState=function(){return h},this.getSurface=function(){return c},this.initStates=function(t){for(var e=(t=t instanceof Array?t:[t]).length,i=0;i<e;i++){var n=t[i];n._initialized||n._initState(c)}},this.run=function(){if(n.gameStates instanceof Array)for(var t=n.gameStates.length,e=0;e<t;e++){var i=n.gameStates[e];i._initialized||i._initState(c)}o.setState(n.state),n.simpleLoop?requestAnimationFrame(d):(n.framerate&&(s=n.framerate,l=1/s),requestAnimationFrame(y))},this.setViewMode=function(t){if(i&&(i=C_NULL,window.removeEventListener("resize",m)),"string"==typeof t)switch(t.trim().toLowerCase()){case"scale-fit":case"scale_fit":e=C_VIEW_SCALE_FIT;break;case"scale-stretch":case"scale_stretch":e=C_VIEW_SCALE_STRETCH;break;case"expand":e=C_VIEW_EXPAND;break;default:e=C_VIEW_CENTER}else e=t;a.removeAttribute("style"),a.style.position="absolute",i=v.update[e],v.init[e](),i&&window.addEventListener("resize",m)},this.getViewMode=function(){return e},this.updateView=function(){i&&i()},a=document.getElementById(n.canvasId),r=a.parentElement,c=new myst.Surface({fromCanvas:a}),n.background&&c.setFillClearMethod(n.background),n.viewMode&&this.setViewMode(n.viewMode)};
/* myst.js 0.9.8
 * (c) 2024 Danijel Durakovic
 * MIT license */
"use strict";const myst={},C_NULL=void 0,C_EMPTYF=function(){},C_VIEW_DEFAULT=0,C_VIEW_CENTER=1,C_VIEW_SCALE_FIT=2,C_VIEW_SCALE_STRETCH=3,C_VIEW_EXPAND=4;myst.compose=function(){return Object.assign.apply(null,arguments)},myst.clamp=function(t,e,i){return t<=e?e:i<=t?i:t},myst.getRandomInt=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},myst.coinFlip=function(){return 1==Math.floor(2*Math.random())},myst.diceRoll=function(t){return t=1<=t?t:6,Math.floor(Math.random()*t)+1},myst.shuffle=function(t){let e=t.length;for(;--e;){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}},myst.choose=function(t){if(t instanceof Array)return t[Math.floor(Math.random()*t.length)]},myst.pick=function(t){if(t instanceof Array&&0<t.length)return t.splice(Math.floor(Math.random()*t.length),1)[0]},myst.pointInRect=function(t,e,i,n,o,s){return i<=t&&t<i+o&&n<=e&&e<n+s},myst.pointInCircle=function(t,e,i,n,o){return(t-i)*(t-i)+(e-n)*(e-n)<o*o},myst.linesIntersect=function(t,e,i,n,o,s,a,r){function h(t,e,i,n,o,s){return(n-e)*(o-t)<(s-e)*(i-t)}return h(t,e,o,s,a,r)!=h(i,n,o,s,a,r)&&h(t,e,i,n,o,s)!=h(t,e,i,n,a,r)},myst.pointToPointDistance=function(t,e,i,n){return Math.sqrt((t-i)*(t-i)+(e-n)*(e-n))},myst.pointToLineDistance=function(t,e,i,n,o,s){var o=o-i,s=s-n,a=o*o+s*s;return 0==a?0:(a=i+(i=Math.min(1,Math.max(0,(o*(t-i)+s*(e-n))/a)))*o,o=n+i*s,Math.sqrt((t-a)*(t-a)+(e-o)*(e-o)))},myst.movePoint=function(t,e,i,n,o){n=180*Math.atan2(n-e,i-t)/Math.PI;return[t+Math.floor(Math.cos(n*Math.PI/180)*o),e+Math.floor(Math.sin(n*Math.PI/180)*o)]},myst.rotatePoint=function(t,e,i,n,o){return o*=Math.PI/180,t-=i,e-=n,[Math.floor(t*Math.cos(o)-e*Math.sin(o))+i,Math.floor(e*Math.cos(o)+t*Math.sin(o))+n]},myst.iter=function(t,e){let i=0;for(var n in t){var o=t[n];!Object.prototype.hasOwnProperty.call(t,n)||o instanceof Function||e(n,o,i++)}},myst.applyToGroup=function(t,i,n){void 0!==n&&(n=n instanceof Array?n:[n]),myst.iter(t,function(t,e){e[i]instanceof Function&&e[i].apply(e,n)})},myst.getFilenameExtension=function(t){return t.split(".").pop().toLowerCase()},myst.Grid2D=function(t,i,n){this.width=t,this.height=i,this.data=new Array(t*i),n=void 0===n?0:n,this.clear=function(){var e=t*i;for(let t=0;t<e;++t)this.data[t]=n},this.get=function(t,e){return this.data[e*this.width+t]},this.set=function(t,e,i){this.data[e*this.width+t]=i}},myst.Timer=function(t){(t=t||1)<1&&(t=1);let e=0;this.ticked=!1,this.run=function(){return(e+=1)>=t?(e-=t,this.ticked=!0):this.ticked=!1},this.reset=function(){e=0,this.ticked=!1}},myst.Tween=function(n,o,s,a,r,h,c,t){if(isNaN(s)||isNaN(o)||isNaN(n)||s<=0)throw new Error("Erroneous parameters for Tween.");h instanceof Function||(h=myst.ease.linear);let l=null,f=15,u=a instanceof Function,d=r instanceof Function,y=c instanceof Function,e=t instanceof Function;function k(t){var e=t/s;let i=n+h(e)*(o-n);y&&(i=c(i)),u&&a(i),l=e<1?setTimeout(function(){k(t+f)},f):(u&&a(o),d&&r(),clearTimeout(l),null)}this.stop=function(){clearTimeout(l),l=null},this.start=function(){null===l&&k(0)},this.restart=function(){null!==l&&clearTimeout(l),k(0)},this.finish=function(){null!==l&&(clearTimeout(l),l=null,a instanceof Function&&a(o),e)&&t()},this.isActive=function(){return null!==l}},myst.ease={linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return t<.5?2*t*t:(4-2*t)*t-1},backIn:function(t){return t*t*t-.4*t*Math.sin(t*Math.PI)},backOut:function(t){return t*t*t- -1.2*t*Math.sin(t*Math.PI)}},myst.AssetLoader=function(){let h=this,c={};function e(h){this.get=function(){var t,e,i,n=arguments.length,o={};let s=0,a,r;for(a=0;a<n;a++)if("string"==typeof arguments[a])for(t=arguments[a].trim().replace(/,/g,"").split(/\s+/),r=0;r<t.length;r++)e=t[r],i=h[e],o[e]=i,s++;return 1==s?o[Object.keys(o)[0]]:1<s?o:void 0}}this.handler={},this.handler.graphics=function(t,e){let i=new Image;i.src=t,i.addEventListener("load",function(){e(i)})},this.handler.data=function(t,e){let i=new XMLHttpRequest;i.open("get",t,!0),i.send(null),i.onreadystatechange=function(){var t;4===i.readyState&&200===i.status&&(t=i.responseText,t=JSON.parse(t),e(t))}},this.handler.text=function(t,e){let i=new XMLHttpRequest;i.open("get",t,!0),i.send(null),i.onreadystatechange=function(){var t;4===i.readyState&&200===i.status&&(t=i.responseText,e(t))}},this.load=function(t){var e=t.assets;if(e){let o=t.done||C_EMPTYF,s=t.progress||C_EMPTYF,a=0,r=0,i=0;return myst.iter(e,function(t,e){i++,myst.iter(e,function(){r++})}),myst.iter(e,function(i,t){let n=h.handler[i];n instanceof Function&&(c[i]||(c[i]={}),myst.iter(t,function(e,t){n(t,function(t){c[i][e]=t,a++,s(a,r),a===r&&o()})}))}),c}},this.get=function(){var t,e,i,n=arguments.length,o={};let s=0,a,r;for(a=0;a<n;a++)if("string"==typeof arguments[a])for(t=arguments[a].trim().replace(/,/g,"").split(/\s+/),r=0;r<t.length;r++)2===(e=t[r].split(".")).length&&(i=e[0],e=e[1],i=c[i]?c[i][e]:void 0,o[e]=i,s++);return 1==s?o[Object.keys(o)[0]]:1<s?o:void 0},this.from=function(t){if("string"==typeof t)return new e(c[t.trim()])},this.getResources=function(){return c}},myst.Input=function(a){let r=0,h=1,c=a.getSurface().getCanvas(),l=c.parentElement;function f(t,e){let i,n;switch(a.getViewMode()){case C_VIEW_SCALE_FIT:i=n=c.offsetWidth<l.offsetWidth?c.height/l.offsetHeight:c.width/l.offsetWidth;break;case C_VIEW_SCALE_STRETCH:i=c.width/l.offsetWidth,n=c.height/l.offsetHeight;break;case C_VIEW_EXPAND:case C_VIEW_CENTER:case C_VIEW_DEFAULT:i=n=1}var o=c.getBoundingClientRect(),s=(e===h?t.changedTouches[0]:t).clientX,e=(e===h?t.changedTouches[0]:t).clientY;return[Math.floor((s-o.left)*i),Math.floor((e-o.top)*n)]}let u={press:[],move:[],release:[]};function e(e,i){i.preventDefault&&i.preventDefault();var t=i.which||i.button;if(1===t){var n=f(i,r);let t=e.length;for(;t--;){var o=e[t],s=o[0],o=o[1];o&&!o._active||s(n)}}}function i(e,i){if(i.preventDefault&&i.preventDefault(),!(1<i.touches.length)){var n=f(i,h);let t=e.length;for(;t--;){var o=e[t],s=o[0],o=o[1];o&&!o._active||s(n)}}}function n(e){this.bindTo=function(t){t&&(e[1]=t)}}c.addEventListener("mousedown",function(t){e(u.press,t)}),c.addEventListener("touchstart",function(t){i(u.press,t)}),window.addEventListener("mousemove",function(e){{var i=u.move,n=(e.preventDefault&&e.preventDefault(),f(e,r));let t=i.length;for(;t--;){var o=i[t],s=o[0],o=o[1];o&&!o._active||s(n)}}}),window.addEventListener("touchmove",function(t){i(u.move,t)}),window.addEventListener("mouseup",function(t){e(u.release,t)}),window.addEventListener("touchend",function(t){i(u.release,t)}),this.on=function(t,e,i){t=u[t],e=[e,C_NULL,i];return t.push(e),new n(e)},this.off=function(t,e){if(t||e)if(e){var i=u[t];if(i){let t=i.length;for(;t--;)i[t][2]===e&&i.splice(t,1)}}else u[t]=[];else u={press:[],move:[],release:[]}}},myst.KeyInput=function(){let i=this,n=[],o=[];function s(t,e){n.push({type:t,keycode:e})}this.KEYDOWN=0,this.KEYUP=1,document.addEventListener("keydown",function(t){var e=t.keyCode||t.which;e!==i.keyBackspace&&e!==i.keyAlt||t.preventDefault(),o[e]||(o[e]=!0,s(i.KEYDOWN,e))}),document.addEventListener("keyup",function(t){var e=t.keyCode||t.which;e!==i.keyBackspace&&e!==i.keyAlt||t.preventDefault(),o[e]&&(delete o[e],s(i.KEYUP,e))}),window.onblur=function(){n=[],o=[]},this.clear=function(){n=[],o=[]},this.pollEvent=function(){return n.shift()},this.isAlphanumeric=function(t){return!!(47<t&&t<58||64<t&&t<91||96<t&&t<123)},this.getCharacter=function(t){return String.fromCharCode(t)},this.isKeyDown=function(t){t=o[t];return void 0!==t&&t},myst.compose(this,{keyCancel:3,keyHelp:6,keyBackspace:8,keyTab:9,keyClear:12,keyEnter:13,keyReturn:14,keyShift:16,keyControl:17,keyAlt:18,keyPause:19,keyCapsLock:20,keyEscape:27,keySpace:32,keyPageUp:33,keyPageDown:34,keyEnd:35,keyHome:36,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyPrintscreen:44,keyInsert:45,keyDelete:46,key0:48,key1:49,key2:50,key3:51,key4:52,key5:53,key6:54,key7:55,key8:56,key9:57,keySemicolon:59,keyEquals:61,keyA:65,keyB:66,keyC:67,keyD:68,keyE:69,keyF:70,keyG:71,keyH:72,keyI:73,keyJ:74,keyK:75,keyL:76,keyM:77,keyN:78,keyO:79,keyP:80,keyQ:81,keyR:82,keyS:83,keyT:84,keyU:85,keyV:86,keyW:87,keyX:88,keyY:89,keyZ:90,keyContextMenu:93,keyNumpad0:96,keyNumpad1:97,keyNumpad2:98,keyNumpad3:99,keyNumpad4:100,keyNumpad5:101,keyNumpad6:102,keyNumpad7:103,keyNumpad8:104,keyNumpad9:105,keyMultiply:106,keyAdd:107,keySeparator:108,keySubtract:109,keyDecimal:110,keyDivide:111,keyF1:112,keyF2:113,keyF3:114,keyF4:115,keyF5:116,keyF6:117,keyF7:118,keyF8:119,keyF9:120,keyF10:121,keyF11:122,keyF12:123,keyF13:124,keyF14:125,keyF15:126,keyF16:127,keyF17:128,keyF18:129,keyF19:130,keyF20:131,keyF21:132,keyF22:133,keyF23:134,keyF24:135,keyNumLock:144,keyScrollLock:145,keyComma:188,keyPeriod:190,keySlash:191,keyBackQuote:192,keyOpenBracket:219,keyBackSlash:220,keyCloseBracket:221,keyQuote:222,keyMeta:224})},myst.Configuration=function(e,i){let n=this;this.save=function(){localStorage.setItem(e,JSON.stringify(n))},this.load=function(){var t=localStorage.getItem(e),t=t?JSON.parse(t):i;myst.iter(n,function(t){delete n[t]}),myst.iter(t,function(t,e){n[t]=e})},this.remove=function(){localStorage.removeItem(e)}},myst.Render=function(_){this.ctx=_,this.setAlpha=function(t){void 0===t?t=1:t<=0?t=0:1<=t&&(t=1),_.globalAlpha=t},this.rotate=function(t,e){_.save(),_.translate(e[0],e[1]),_.rotate(t*Math.PI/180),_.translate(-e[0],-e[1])},this.restore=function(){_.restore()},this.line=function(t,e,i,n,o,s){s=void 0===s?1:s,_.strokeStyle=o=void 0===o?"#fff":o,_.lineWidth=s,_.beginPath(),_.moveTo(t,e),_.lineTo(i,n),_.stroke()},this.rect=function(t,e,i,n,o,s,a){s=void 0===s?1:s,_.strokeStyle=o=void 0===o?"#fff":o,_.lineWidth=s,void 0===a||0===a?_.strokeRect(t,e,i,n):(a=a instanceof Array?[a[0]||0,a[1]||0,a[2]||0,a[3]||0]:[a,a,a,a],_.beginPath(),_.moveTo(t+a[0],e),_.lineTo(t+i-a[1],e),_.quadraticCurveTo(t+i,e,t+i,e+a[1]),_.lineTo(t+i,e+n-a[3]),_.quadraticCurveTo(t+i,e+n,t+i-a[3],e+n),_.lineTo(t+a[2],e+n),_.quadraticCurveTo(t,e+n,t,e+n-a[2]),_.lineTo(t,e+a[0]),_.quadraticCurveTo(t,e,t+a[0],e),_.closePath(),_.stroke())},this.rectFill=function(t,e,i,n,o,s){_.fillStyle=o=void 0===o?"#fff":o,void 0===s||0===s?_.fillRect(t,e,i,n):(s=s instanceof Array?[s[0]||0,s[1]||0,s[2]||0,s[3]||0]:[s,s,s,s],_.beginPath(),_.moveTo(t+s[0],e),_.lineTo(t+i-s[1],e),_.quadraticCurveTo(t+i,e,t+i,e+s[1]),_.lineTo(t+i,e+n-s[3]),_.quadraticCurveTo(t+i,e+n,t+i-s[3],e+n),_.lineTo(t+s[2],e+n),_.quadraticCurveTo(t,e+n,t,e+n-s[2]),_.lineTo(t,e+s[0]),_.quadraticCurveTo(t,e,t+s[0],e),_.closePath(),_.fill())},this.arc=function(t,e,i,n,o,s,a){s=void 0===s?"#fff":s,a=void 0===a?1:a,n*=Math.PI/180,o*=Math.PI/180,_.strokeStyle=s,_.lineWidth=a,_.beginPath(),_.arc(t,e,i,n,o),_.stroke()},this.arcFill=function(t,e,i,n,o,s){s=void 0===s?"#fff":s,n*=Math.PI/180,o*=Math.PI/180,_.fillStyle=s,_.beginPath(),_.arc(t,e,i,n,o),_.closePath(),_.fill()},this.sector=function(t,e,i,n,o,s,a){s=void 0===s?"#fff":s,a=void 0===a?1:a,n*=Math.PI/180,o*=Math.PI/180,_.strokeStyle=s,_.lineWidth=a,_.beginPath(),_.moveTo(t,e),_.arc(t,e,i,n,o),_.lineTo(t,e),_.stroke()},this.sectorFill=function(t,e,i,n,o,s){s=void 0===s?"#fff":s,n*=Math.PI/180,o*=Math.PI/180,_.fillStyle=s,_.beginPath(),_.moveTo(t,e),_.arc(t,e,i,n,o),_.lineTo(t,e),_.closePath(),_.fill()},this.circle=function(t,e,i,n,o){o=void 0===o?1:o,_.strokeStyle=n=void 0===n?"#fff":n,_.lineWidth=o,_.beginPath(),_.arc(t,e,i,0,2*Math.PI),_.stroke()},this.circleFill=function(t,e,i,n){_.fillStyle=n=void 0===n?"#fff":n,_.beginPath(),_.arc(t,e,i,0,2*Math.PI),_.closePath(),_.fill()},this.polygon=function(e,t,i){i=void 0===i?1:i,_.strokeStyle=t=void 0===t?"#fff":t,_.lineWidth=i;var n=e.length;_.beginPath();for(let t=0;t<n;t++){var o=e[t],s=t<n-1?e[t+1]:e[0];_.moveTo(o[0],o[1]),_.lineTo(s[0],s[1])}_.stroke()},this.polygonFill=function(e,t){_.fillStyle=t=void 0===t?"#fff":t,_.beginPath(),_.moveTo(e[0][0],e[0][1]);var i=e.length;for(let t=1;t<i;t++){var n=e[t];_.lineTo(n[0],n[1])}_.closePath(),_.fill()},this.graphics=function(t,e,i,n,o){void 0===n||void 0===o?_.drawImage(t,e,i):_.drawImage(t,e,i,n,o)},this.surface=function(t,e,i){_.drawImage(t.canvas,e,i)},this.tile=function(t,e,i,n,o,s,a){_.drawImage(t,s,a,n,o,e,i,n,o)},this.stretchTile=function(t,e,i,n,o,s,a,r,h){_.drawImage(t,s,a,n,o,e,i,r,h)},this.text=function(t,e,i,n,o,s){n=void 0===n?"#000":n,o=void 0===o?"left":o,s=void 0===s?"11px sans-serif":s,_.textBaseline="top",_.fillStyle=n,_.textAlign=o,_.font=s,_.fillText(t,e,i)},this.bmptext=function(e,i,n,o,t,s){var a=i.length,r=e.width,h=e.height,c=e.gfx,l=e.tilesH*(t=void 0===t?0:t);let f=0;var u=e.varwidth;let d=0,y,k,m,v;var p,g,C=e.tileOffset;if(0<s){if(u){for(k=0;k<a;k++)m=i.charCodeAt(k)-32,f+=e.widths[m]+e.spacing;y=f,f=0}else y=a*r;d=1==s?Math.floor(y/2):y}for(k=0;k<a;k++){v=(m=i.charCodeAt(k)-32)-C;let t;u?(t=n+f,f+=e.widths[m]+e.spacing):t=n+k*(r+e.spacing),0!==m&&(p=r*(v%e.tilesPerRow),g=h*Math.floor(v/e.tilesPerRow)+l,_.drawImage(c,p,g,r,h,t-d,o,r,h))}}},myst.Font=function(e){if(this.gfx=e.graphics,this.width=e.size[0],this.height=e.size[1],this.spacing=void 0===e.spacing?2:e.spacing,this.tileOffset=void 0===e.offset?0:e.offset,this.tilesPerRow=Math.floor(this.gfx.width/this.width),this.tilesH=Math.ceil(95/this.tilesPerRow)*this.height,this.varwidth=void 0!==e.widths,this.varwidth)if(e.widths instanceof Array)this.widths=e.width;else{this.widths=[];for(let t=32;t<=126;t++){var i=String.fromCharCode(t),i=e.widths[i];this.widths.push(i||this.width)}}},myst.Surface=function(t){let i,e,n;var o;(t=t||{}).fromCanvas?(i=t.fromCanvas,this.width=i.width,this.height=i.height):(o=void 0===t.width?100:t.width,t=void 0===t.height?100:t.height,i=document.createElement("canvas"),this.width=i.width=o,this.height=i.height=t),e=i.getContext("2d");let s=this.width,a=this.height;this.canvas=i,this.render=new myst.Render(e),this.cm_clear=function(){e.clearRect(0,0,this.width,this.height)},this.cm_fill=function(){e.fillStyle=n,e.fillRect(0,0,this.width,this.height)},this.clear=C_NULL,this.setDefaultClearMethod=function(){this.clear=this.cm_clear},this.setFillClearMethod=function(t){n=void 0===t?"#000":t,this.clear=this.cm_fill},this.getCanvas=function(){return i},this.resetSize=function(){this.resize(s,a)},this.resize=function(t,e){this.width=i.width=t,this.height=i.height=e},this.setDefaultClearMethod()},myst.State=function(t){t=t||{},this._initialized=!1,this._initState=function(t){this._initialized||(this._initialized=!0,this.surface=t,this.paint=t.render,this.init())},this._active=!1,this.surface=C_NULL,this.paint=C_NULL,this.isActive=function(){return this._active},this.init=t.init||C_EMPTYF,this.enter=t.enter||C_EMPTYF,this.exit=t.exit||C_EMPTYF,this.update=t.update||C_EMPTYF,this.draw=t.draw||C_EMPTYF},myst.Game=function(n){let t=this,o=C_NULL,a=C_NULL,r,h,s=Date.now()/1e3,c=0,l,f=1/60;function u(t){var e=Date.now()/1e3;let i=e-s;for(.25<i&&(i=.25),s=e,c+=i;c>=f;)o.update(),c-=f;o.draw(),requestAnimationFrame(u)}function d(){o.draw(),requestAnimationFrame(d)}let e=C_VIEW_DEFAULT,i=C_NULL,y=C_NULL,k=20,m={init:{},update:{}};function v(){clearTimeout(y),y=setTimeout(i,k)}m.init[C_VIEW_CENTER]=function(){a.resetSize(),r.style.width=a.width+"px",r.style.height=a.height+"px",r.style.top="0",r.style.left="0",r.style.right="0",r.style.bottom="0",r.style.margin="auto"},m.update[C_VIEW_CENTER]=C_NULL,m.init[C_VIEW_SCALE_FIT]=function(){a.resetSize(),m.update[C_VIEW_SCALE_FIT](),r.style.top="0",r.style.left="0",r.style.right="0",r.style.bottom="0",r.style.margin="auto"},m.update[C_VIEW_SCALE_FIT]=function(){var t=a.width,e=a.height,i=h.offsetWidth,n=h.offsetHeight;let o=n*(t/e),s;s=o>i?(o=i)*(e/t):n,r.style.width=o+"px",r.style.height=s+"px"},m.init[C_VIEW_SCALE_STRETCH]=function(){a.resetSize(),r.style.width="100%",r.style.height="100%",r.style.top="0",r.style.left="0"},m.update[C_VIEW_SCALE_STRETCH]=C_NULL,m.init[C_VIEW_EXPAND]=function(){m.update[C_VIEW_EXPAND](),r.style.top="0",r.style.left="0"},m.update[C_VIEW_EXPAND]=function(){a.resize(h.offsetWidth,h.offsetHeight)},this.setState=function(t){o&&(o._active=!1,o.exit()),(o=t)._initialized||o._initState(a),o._active=!0,o.enter()},this.getState=function(){return o},this.getSurface=function(){return a},this.initStates=function(e){var i=(e=e instanceof Array?e:[e]).length;for(let t=0;t<i;t++){var n=e[t];n._initialized||n._initState(a)}},this.run=function(){if(n.gameStates instanceof Array){var e=n.gameStates.length;for(let t=0;t<e;t++){var i=n.gameStates[t];i._initialized||i._initState(a)}}t.setState(n.state),n.simpleLoop?requestAnimationFrame(d):(n.framerate&&(l=n.framerate,f=1/l),requestAnimationFrame(u))},this.setViewMode=function(t){if(i&&(i=C_NULL,window.removeEventListener("resize",v)),"string"==typeof t)switch(t.trim().toLowerCase()){case"scale-fit":case"scale_fit":e=C_VIEW_SCALE_FIT;break;case"scale-stretch":case"scale_stretch":e=C_VIEW_SCALE_STRETCH;break;case"expand":e=C_VIEW_EXPAND;break;default:e=C_VIEW_CENTER}else e=t;r.removeAttribute("style"),r.style.position="absolute",i=m.update[e],m.init[e](),i&&window.addEventListener("resize",v)},this.getViewMode=function(){return e},this.updateView=function(){i&&i()},r=document.getElementById(n.canvasId),h=r.parentElement,a=new myst.Surface({fromCanvas:r}),n.background&&a.setFillClearMethod(n.background),n.viewMode&&this.setViewMode(n.viewMode)};
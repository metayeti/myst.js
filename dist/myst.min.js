/* myst.js 0.9.6
 * (c) 2020 Danijel Durakovic
 * MIT License */
"use strict";var myst={},C_NULL=void 0,C_EMPTYF=function(){},C_VIEW_DEFAULT=0,C_VIEW_CENTER=1,C_VIEW_SCALE_FIT=2,C_VIEW_SCALE_STRETCH=3,C_VIEW_EXPAND=4;myst.compose=function(){if(Object.assign)return Object.assign.apply(null,arguments);for(var t=arguments[0],e=arguments.length,i=1;i<e;++i){var n=arguments[i];if(n)for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])}return t},myst.clamp=function(t,e,i){return t<=e?e:i<=t?i:t},myst.getRandomInt=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},myst.coinFlip=function(){return 1==Math.floor(2*Math.random())},myst.diceRoll=function(t){return t=1<=t?t:6,Math.floor(Math.random()*t)+1},myst.shuffle=function(t){for(var e=t.length;--e;){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n}},myst.choose=function(t){if(t instanceof Array)return t[Math.floor(Math.random()*t.length)]},myst.pick=function(t){if(t instanceof Array&&0<t.length)return t.splice(Math.floor(Math.random()*t.length),1)[0]},myst.pointInRect=function(t,e,i,n,o,a){return i<=t&&t<i+o&&n<=e&&e<n+a},myst.pointInCircle=function(t,e,i,n,o){return(t-i)*(t-i)+(e-n)*(e-n)<o*o},myst.linesIntersect=function(t,e,i,n,o,a,s,r){function h(t,e,i,n,o,a){return(n-e)*(o-t)<(a-e)*(i-t)}return h(t,e,o,a,s,r)!=h(i,n,o,a,s,r)&&h(t,e,i,n,o,a)!=h(t,e,i,n,s,r)},myst.pointToPointDistance=function(t,e,i,n){return Math.sqrt((t-i)*(t-i)+(e-n)*(e-n))},myst.pointToLineDistance=function(t,e,i,n,o,a){var s=o-i,o=a-n,a=s*s+o*o;if(0==a)return 0;a=Math.min(1,Math.max(0,(s*(t-i)+o*(e-n))/a)),s=i+a*s,o=n+a*o;return Math.sqrt((t-s)*(t-s)+(e-o)*(e-o))},myst.movePoint=function(t,e,i,n,o){i=180*Math.atan2(n-e,i-t)/Math.PI;return[t+Math.floor(Math.cos(i*Math.PI/180)*o),e+Math.floor(Math.sin(i*Math.PI/180)*o)]},myst.rotatePoint=function(t,e,i,n,o){return o*=Math.PI/180,t-=i,e-=n,[Math.floor(t*Math.cos(o)-e*Math.sin(o))+i,Math.floor(e*Math.cos(o)+t*Math.sin(o))+n]},myst.iter=function(t,e){var i,n=0;for(i in t){var o=t[i];!Object.prototype.hasOwnProperty.call(t,i)||o instanceof Function||e(i,o,n++)}},myst.applyToGroup=function(t,i,n){void 0!==n&&(n=n instanceof Array?n:[n]),myst.iter(t,function(t,e){e[i]instanceof Function&&e[i].apply(e,n)})},myst.getFilenameExtension=function(t){return t.split(".").pop().toLowerCase()},myst.Grid2D=function(i,n,o){this.width=i,this.height=n,this.data=new Array(i*n),o=void 0===o?0:o,this.clear=function(){for(var t=i*n,e=0;e<t;++e)this.data[e]=o},this.get=function(t,e){return this.data[e*this.width+t]},this.set=function(t,e,i){this.data[e*this.width+t]=i}},myst.Timer=function(t){(t=t||1)<1&&(t=1);var e=0;this.ticked=!1,this.run=function(){return t<=(e+=1)?(e-=t,this.ticked=!0):this.ticked=!1},this.reset=function(){e=0,this.ticked=!1}},myst.Tween=function(n,o,a,s,r,h,c,t){if(isNaN(a)||isNaN(o)||isNaN(n)||a<=0)throw new Error("Erroneous parameters for Tween.");h instanceof Function||(h=myst.ease.linear);var f=null,u=15,l=s instanceof Function,d=r instanceof Function,y=c instanceof Function,e=t instanceof Function;function v(t){var e=t/a,i=n+h(e)*(o-n);y&&(i=c(i)),l&&s(i),f=e<1?setTimeout(function(){v(t+u)},u):(l&&s(o),d&&r(),clearTimeout(f),null)}this.stop=function(){clearTimeout(f),f=null},this.start=function(){null===f&&v(0)},this.restart=function(){null!==f&&clearTimeout(f),v(0)},this.finish=function(){null!==f&&(clearTimeout(f),f=null,s instanceof Function&&s(o),e&&t())},this.isActive=function(){return null!==f}},myst.ease={linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return t<.5?2*t*t:(4-2*t)*t-1},backIn:function(t){return t*t*t-.4*t*Math.sin(t*Math.PI)},backOut:function(t){return t*t*t- -1.2*t*Math.sin(t*Math.PI)}},myst.AssetLoader=function(){var h=this,c={};function e(h){this.get=function(){for(var t,e,i,n,o=arguments.length,a={},s=0,r=0;r<o;r++)if("string"==typeof arguments[r])for(t=arguments[r].trim().replace(/,/g,"").split(/\s+/),n=0;n<t.length;n++)e=t[n],i=h[e],a[e]=i,s++;return 1==s?a[Object.keys(a)[0]]:1<s?a:void 0}}this.handler={},this.handler.graphics=function(t,e){var i=new Image;i.src=t,i.addEventListener("load",function(){e(i)})},this.handler.data=function(t,e){var i=new XMLHttpRequest;i.open("get",t,!0),i.send(null),i.onreadystatechange=function(){var t;4===i.readyState&&200===i.status&&(t=i.responseText,t=JSON.parse(t),e(t))}},this.handler.text=function(t,e){var i=new XMLHttpRequest;i.open("get",t,!0),i.send(null),i.onreadystatechange=function(){var t;4===i.readyState&&200===i.status&&(t=i.responseText,e(t))}},this.load=function(t){var e=t.assets;if(e){var o=t.done||C_EMPTYF,a=t.progress||C_EMPTYF,s=0,r=0;return myst.iter(e,function(t,e){myst.iter(e,function(){r++})}),myst.iter(e,function(i,t){var n=h.handler[i];n instanceof Function&&(c[i]||(c[i]={}),myst.iter(t,function(e,t){n(t,function(t){c[i][e]=t,a(++s,r),s===r&&o()})}))}),c}},this.get=function(){for(var t,e,i,n,o=arguments.length,a={},s=0,r=0;r<o;r++)if("string"==typeof arguments[r])for(t=arguments[r].trim().replace(/,/g,"").split(/\s+/),n=0;n<t.length;n++)2===(e=t[n].split(".")).length&&(i=e[0],e=e[1],i=c[i]?c[i][e]:void 0,a[e]=i,s++);return 1==s?a[Object.keys(a)[0]]:1<s?a:void 0},this.from=function(t){if("string"==typeof t)return new e(c[t.trim()])},this.getResources=function(){return c}},myst.Input=function(s){var r=0,h=1,c=s.getSurface().getCanvas(),f=c.parentElement;function u(t,e){var i,n;switch(s.getViewMode()){case C_VIEW_SCALE_FIT:i=n=c.offsetWidth<f.offsetWidth?c.height/f.offsetHeight:c.width/f.offsetWidth;break;case C_VIEW_SCALE_STRETCH:i=c.width/f.offsetWidth,n=c.height/f.offsetHeight;break;case C_VIEW_EXPAND:case C_VIEW_CENTER:case C_VIEW_DEFAULT:i=n=1}var o=c.getBoundingClientRect(),a=(e===h?t.changedTouches[0]:t).clientX,t=(e===h?t.changedTouches[0]:t).clientY;return[Math.floor((a-o.left)*i),Math.floor((t-o.top)*n)]}var o={press:[],move:[],release:[]};function e(t,e){if(e.preventDefault&&e.preventDefault(),1===(e.which||e.button))for(var i=u(e,r),n=t.length;n--;){var o=t[n],a=o[0],o=o[1];o&&!o._active||a(i)}}function i(t,e){if(e.preventDefault&&e.preventDefault(),!(1<e.touches.length))for(var i=u(e,h),n=t.length;n--;){var o=t[n],a=o[0],o=o[1];o&&!o._active||a(i)}}function n(e){this.bindTo=function(t){t&&(e[1]=t)}}c.addEventListener("mousedown",function(t){e(o.press,t)}),c.addEventListener("touchstart",function(t){i(o.press,t)}),window.addEventListener("mousemove",function(t){!function(t,e){e.preventDefault&&e.preventDefault();for(var i=u(e,r),n=t.length;n--;){var o=t[n],a=o[0],o=o[1];o&&!o._active||a(i)}}(o.move,t)}),window.addEventListener("touchmove",function(t){i(o.move,t)}),window.addEventListener("mouseup",function(t){e(o.release,t)}),window.addEventListener("touchend",function(t){i(o.release,t)}),this.on=function(t,e,i){t=o[t],i=[e,C_NULL,i];return t.push(i),new n(i)},this.off=function(t,e){if(t||e)if(e){var i=o[t];if(i)for(var n=i.length;n--;)i[n][2]===e&&i.splice(n,1)}else o[t]=[];else o={press:[],move:[],release:[]}}},myst.KeyInput=function(){var i=this,n=[],o=[];function a(t,e){n.push({type:t,keycode:e})}this.KEYDOWN=0,this.KEYUP=1,document.addEventListener("keydown",function(t){var e=t.keyCode||t.which;e!==i.keyBackspace&&e!==i.keyAlt||t.preventDefault(),o[e]||(o[e]=!0,a(i.KEYDOWN,e))}),document.addEventListener("keyup",function(t){var e=t.keyCode||t.which;e!==i.keyBackspace&&e!==i.keyAlt||t.preventDefault(),o[e]&&(delete o[e],a(i.KEYUP,e))}),window.onblur=function(){n=[],o=[]},this.clear=function(){n=[],o=[]},this.pollEvent=function(){return n.shift()},this.isAlphanumeric=function(t){return!!(47<t&&t<58||64<t&&t<91||96<t&&t<123)},this.getCharacter=function(t){return String.fromCharCode(t)},this.isKeyDown=function(t){t=o[t];return void 0!==t&&t},myst.compose(this,{keyCancel:3,keyHelp:6,keyBackspace:8,keyTab:9,keyClear:12,keyEnter:13,keyReturn:14,keyShift:16,keyControl:17,keyAlt:18,keyPause:19,keyCapsLock:20,keyEscape:27,keySpace:32,keyPageUp:33,keyPageDown:34,keyEnd:35,keyHome:36,keyLeft:37,keyUp:38,keyRight:39,keyDown:40,keyPrintscreen:44,keyInsert:45,keyDelete:46,key0:48,key1:49,key2:50,key3:51,key4:52,key5:53,key6:54,key7:55,key8:56,key9:57,keySemicolon:59,keyEquals:61,keyA:65,keyB:66,keyC:67,keyD:68,keyE:69,keyF:70,keyG:71,keyH:72,keyI:73,keyJ:74,keyK:75,keyL:76,keyM:77,keyN:78,keyO:79,keyP:80,keyQ:81,keyR:82,keyS:83,keyT:84,keyU:85,keyV:86,keyW:87,keyX:88,keyY:89,keyZ:90,keyContextMenu:93,keyNumpad0:96,keyNumpad1:97,keyNumpad2:98,keyNumpad3:99,keyNumpad4:100,keyNumpad5:101,keyNumpad6:102,keyNumpad7:103,keyNumpad8:104,keyNumpad9:105,keyMultiply:106,keyAdd:107,keySeparator:108,keySubtract:109,keyDecimal:110,keyDivide:111,keyF1:112,keyF2:113,keyF3:114,keyF4:115,keyF5:116,keyF6:117,keyF7:118,keyF8:119,keyF9:120,keyF10:121,keyF11:122,keyF12:123,keyF13:124,keyF14:125,keyF15:126,keyF16:127,keyF17:128,keyF18:129,keyF19:130,keyF20:131,keyF21:132,keyF22:133,keyF23:134,keyF24:135,keyNumLock:144,keyScrollLock:145,keyComma:188,keyPeriod:190,keySlash:191,keyBackQuote:192,keyOpenBracket:219,keyBackSlash:220,keyCloseBracket:221,keyQuote:222,keyMeta:224})},myst.Configuration=function(e,i){var n=this;this.save=function(){localStorage.setItem(e,JSON.stringify(n))},this.load=function(){var t=localStorage.getItem(e),t=t?JSON.parse(t):i;myst.iter(n,function(t){delete n[t]}),myst.iter(t,function(t,e){n[t]=e})},this.remove=function(){localStorage.removeItem(e)}},myst.Render=function(_){this.ctx=_,this.setAlpha=function(t){void 0===t?t=1:t<=0?t=0:1<=t&&(t=1),_.globalAlpha=t},this.rotate=function(t,e){_.save(),_.translate(e[0],e[1]),_.rotate(t*Math.PI/180),_.translate(-e[0],-e[1])},this.restore=function(){_.restore()},this.line=function(t,e,i,n,o,a){a=void 0===a?1:a,_.strokeStyle=o=void 0===o?"#fff":o,_.lineWidth=a,_.beginPath(),_.moveTo(t,e),_.lineTo(i,n),_.stroke()},this.rect=function(t,e,i,n,o,a,s){a=void 0===a?1:a,_.strokeStyle=o=void 0===o?"#fff":o,_.lineWidth=a,void 0===s||0===s?_.strokeRect(t,e,i,n):(s=s instanceof Array?[s[0]||0,s[1]||0,s[2]||0,s[3]||0]:[s,s,s,s],_.beginPath(),_.moveTo(t+s[0],e),_.lineTo(t+i-s[1],e),_.quadraticCurveTo(t+i,e,t+i,e+s[1]),_.lineTo(t+i,e+n-s[3]),_.quadraticCurveTo(t+i,e+n,t+i-s[3],e+n),_.lineTo(t+s[2],e+n),_.quadraticCurveTo(t,e+n,t,e+n-s[2]),_.lineTo(t,e+s[0]),_.quadraticCurveTo(t,e,t+s[0],e),_.closePath(),_.stroke())},this.rectFill=function(t,e,i,n,o,a){_.fillStyle=o=void 0===o?"#fff":o,void 0===a||0===a?_.fillRect(t,e,i,n):(a=a instanceof Array?[a[0]||0,a[1]||0,a[2]||0,a[3]||0]:[a,a,a,a],_.beginPath(),_.moveTo(t+a[0],e),_.lineTo(t+i-a[1],e),_.quadraticCurveTo(t+i,e,t+i,e+a[1]),_.lineTo(t+i,e+n-a[3]),_.quadraticCurveTo(t+i,e+n,t+i-a[3],e+n),_.lineTo(t+a[2],e+n),_.quadraticCurveTo(t,e+n,t,e+n-a[2]),_.lineTo(t,e+a[0]),_.quadraticCurveTo(t,e,t+a[0],e),_.closePath(),_.fill())},this.arc=function(t,e,i,n,o,a,s){a=void 0===a?"#fff":a,s=void 0===s?1:s,n*=Math.PI/180,o*=Math.PI/180,_.strokeStyle=a,_.lineWidth=s,_.beginPath(),_.arc(t,e,i,n,o),_.stroke()},this.arcFill=function(t,e,i,n,o,a){a=void 0===a?"#fff":a,n*=Math.PI/180,o*=Math.PI/180,_.fillStyle=a,_.beginPath(),_.arc(t,e,i,n,o),_.closePath(),_.fill()},this.sector=function(t,e,i,n,o,a,s){a=void 0===a?"#fff":a,s=void 0===s?1:s,n*=Math.PI/180,o*=Math.PI/180,_.strokeStyle=a,_.lineWidth=s,_.beginPath(),_.moveTo(t,e),_.arc(t,e,i,n,o),_.lineTo(t,e),_.stroke()},this.sectorFill=function(t,e,i,n,o,a){a=void 0===a?"#fff":a,n*=Math.PI/180,o*=Math.PI/180,_.fillStyle=a,_.beginPath(),_.moveTo(t,e),_.arc(t,e,i,n,o),_.lineTo(t,e),_.closePath(),_.fill()},this.circle=function(t,e,i,n,o){o=void 0===o?1:o,_.strokeStyle=n=void 0===n?"#fff":n,_.lineWidth=o,_.beginPath(),_.arc(t,e,i,0,2*Math.PI),_.stroke()},this.circleFill=function(t,e,i,n){_.fillStyle=n=void 0===n?"#fff":n,_.beginPath(),_.arc(t,e,i,0,2*Math.PI),_.closePath(),_.fill()},this.polygon=function(t,e,i){i=void 0===i?1:i,_.strokeStyle=e=void 0===e?"#fff":e,_.lineWidth=i;var n=t.length;_.beginPath();for(var o=0;o<n;o++){var a=t[o],s=o<n-1?t[o+1]:t[0];_.moveTo(a[0],a[1]),_.lineTo(s[0],s[1])}_.stroke()},this.polygonFill=function(t,e){_.fillStyle=e=void 0===e?"#fff":e,_.beginPath(),_.moveTo(t[0][0],t[0][1]);for(var i=t.length,n=1;n<i;n++){var o=t[n];_.lineTo(o[0],o[1])}_.closePath(),_.fill()},this.graphics=function(t,e,i,n,o){void 0===n||void 0===o?_.drawImage(t,e,i):_.drawImage(t,e,i,n,o)},this.surface=function(t,e,i){_.drawImage(t.canvas,e,i)},this.tile=function(t,e,i,n,o,a,s){_.drawImage(t,a,s,n,o,e,i,n,o)},this.stretchTile=function(t,e,i,n,o,a,s,r,h){_.drawImage(t,a,s,n,o,e,i,r,h)},this.text=function(t,e,i,n,o,a){n=void 0===n?"#000":n,o=void 0===o?"left":o,a=void 0===a?"11px sans-serif":a,_.textBaseline="top",_.fillStyle=n,_.textAlign=o,_.font=a,_.fillText(t,e,i)},this.bmptext=function(t,e,i,n,o,a){var s,r,h=e.length,c=t.width,f=t.height,u=t.gfx,l=t.tilesH*(o=void 0===o?0:o),d=0,y=t.varwidth,v=0,k=t.tileOffset;if(0<a){if(y){for(r=0;r<h;r++)p=e.charCodeAt(r)-32,d+=t.widths[p]+t.spacing;s=d,d=0}else s=h*c;v=1==a?Math.floor(s/2):s}for(r=0;r<h;r++){var m,p,g,C=(p=e.charCodeAt(r)-32)-k;y?(m=i+d,d+=t.widths[p]+t.spacing):m=i+r*(c+t.spacing),0!==p&&(g=c*(C%t.tilesPerRow),C=f*Math.floor(C/t.tilesPerRow)+l,_.drawImage(u,g,C,c,f,m-v,n,c,f))}}},myst.Font=function(t){if(this.gfx=t.graphics,this.width=t.size[0],this.height=t.size[1],this.spacing=void 0===t.spacing?2:t.spacing,this.tileOffset=void 0===t.offset?0:t.offset,this.tilesPerRow=Math.floor(this.gfx.width/this.width),this.tilesH=Math.ceil(95/this.tilesPerRow)*this.height,this.varwidth=void 0!==t.widths,this.varwidth)if(t.widths instanceof Array)this.widths=t.width;else{this.widths=[];for(var e=32;e<=126;e++){var i=String.fromCharCode(e),i=t.widths[i];this.widths.push(i||this.width)}}},myst.Surface=function(t){var e,i,n;(t=t||{}).fromCanvas?(n=t.fromCanvas,this.width=n.width,this.height=n.height):(i=void 0===t.width?100:t.width,t=void 0===t.height?100:t.height,n=document.createElement("canvas"),this.width=n.width=i,this.height=n.height=t);var o=n.getContext("2d"),a=this.width,s=this.height;this.canvas=n,this.render=new myst.Render(o),this.cm_clear=function(){o.clearRect(0,0,this.width,this.height)},this.cm_fill=function(){o.fillStyle=e,o.fillRect(0,0,this.width,this.height)},this.clear=C_NULL,this.setDefaultClearMethod=function(){this.clear=this.cm_clear},this.setFillClearMethod=function(t){e=void 0===t?"#000":t,this.clear=this.cm_fill},this.getCanvas=function(){return n},this.resetSize=function(){this.resize(a,s)},this.resize=function(t,e){this.width=n.width=t,this.height=n.height=e},this.setDefaultClearMethod()},myst.State=function(t){t=t||{},this._initialized=!1,this._initState=function(t){this._initialized||(this._initialized=!0,this.surface=t,this.paint=t.render,this.init())},this._active=!1,this.surface=C_NULL,this.paint=C_NULL,this.isActive=function(){return this._active},this.init=t.init||C_EMPTYF,this.enter=t.enter||C_EMPTYF,this.exit=t.exit||C_EMPTYF,this.update=t.update||C_EMPTYF,this.draw=t.draw||C_EMPTYF},myst.Game=function(n){var a,s,o,r=this,h=C_NULL,c=C_NULL,f=Date.now()/1e3,u=0,l=1/60;function d(t){var e=Date.now()/1e3,i=e-f;for(f=e,u+=i=.25<i?.25:i;l<=u;)h.update(),u-=l;h.draw(),requestAnimationFrame(d)}function y(){h.draw(),requestAnimationFrame(y)}var e=C_VIEW_DEFAULT,i=C_NULL,t=C_NULL,v=20,k={init:{},update:{}};function m(){clearTimeout(t),t=setTimeout(i,v)}k.init[C_VIEW_CENTER]=function(){c.resetSize(),a.style.width=c.width+"px",a.style.height=c.height+"px",a.style.top="0",a.style.left="0",a.style.right="0",a.style.bottom="0",a.style.margin="auto"},k.update[C_VIEW_CENTER]=C_NULL,k.init[C_VIEW_SCALE_FIT]=function(){c.resetSize(),k.update[C_VIEW_SCALE_FIT](),a.style.top="0",a.style.left="0",a.style.right="0",a.style.bottom="0",a.style.margin="auto"},k.update[C_VIEW_SCALE_FIT]=function(){var t=c.width,e=c.height,i=s.offsetWidth,n=s.offsetHeight,o=n*(t/e),n=i<o?(o=i)*(e/t):n;a.style.width=o+"px",a.style.height=n+"px"},k.init[C_VIEW_SCALE_STRETCH]=function(){c.resetSize(),a.style.width="100%",a.style.height="100%",a.style.top="0",a.style.left="0"},k.update[C_VIEW_SCALE_STRETCH]=C_NULL,k.init[C_VIEW_EXPAND]=function(){k.update[C_VIEW_EXPAND](),a.style.top="0",a.style.left="0"},k.update[C_VIEW_EXPAND]=function(){c.resize(s.offsetWidth,s.offsetHeight)},this.setState=function(t){h&&(h._active=!1,h.exit()),(h=t)._initialized||h._initState(c),h._active=!0,h.enter()},this.getState=function(){return h},this.getSurface=function(){return c},this.initStates=function(t){for(var e=(t=t instanceof Array?t:[t]).length,i=0;i<e;i++){var n=t[i];n._initialized||n._initState(c)}},this.run=function(){if(n.gameStates instanceof Array)for(var t=n.gameStates.length,e=0;e<t;e++){var i=n.gameStates[e];i._initialized||i._initState(c)}r.setState(n.state),n.simpleLoop?requestAnimationFrame(y):(n.framerate&&(o=n.framerate,l=1/o),requestAnimationFrame(d))},this.setViewMode=function(t){if(i&&(i=C_NULL,window.removeEventListener("resize",m)),"string"==typeof t)switch(t.trim().toLowerCase()){case"scale-fit":case"scale_fit":e=C_VIEW_SCALE_FIT;break;case"scale-stretch":case"scale_stretch":e=C_VIEW_SCALE_STRETCH;break;case"expand":e=C_VIEW_EXPAND;break;default:e=C_VIEW_CENTER}else e=t;a.removeAttribute("style"),a.style.position="absolute",i=k.update[e],k.init[e](),i&&window.addEventListener("resize",m)},this.getViewMode=function(){return e},this.updateView=function(){i&&i()},a=document.getElementById(n.canvasId),s=a.parentElement,c=new myst.Surface({fromCanvas:a}),n.background&&c.setFillClearMethod(n.background),n.viewMode&&this.setViewMode(n.viewMode)};
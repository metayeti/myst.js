/* myst.ui.js 0.2.4
 * (c) 2023 Danijel Durakovic
 * MIT License */
myst.ui=function(){"use strict";let i=null,t=null,o=function(){let e=0;return function(){return++e}}();function c(e,t){return null!=e?e:t}function u(e,t){e instanceof Function&&e.call(t)}let r={Base:function(e,i){(i=i||this)._x=c(e.x,0),i._y=c(e.y,0),i._width=c(e.width,0),i._height=c(e.height,0),i._alpha=c(e.alpha,1),i._angle=c(e.angle,0),i._background=null,i._zIndex=c(e.zIndex,0),i._enabled=Boolean(c(e.enabled,!0)),i._context=c(e.context,t),i._rootContext=i.context,i._owner=null,i._requestRepaint=!0,i._alwaysRepaint=!1,i._surface=new myst.Surface({width:i._width,height:i._height}),i._texSurface=i._surface.canvas,i._events={},i._events.onRepaint=C_EMPTYF,i._events.onAdded=function(){u(e.onAdded,i)},i._events.onRemoved=function(){u(e.onRemoved,i)},i._events.onResized=function(){u(e.onResized,i)},i._events.onEnabled=function(){u(e.onEnabled,i)},i._events.onDisabled=function(){u(e.onDisabled,i)},i.paint=i._surface.render,i.enable=function(){return!1===i._enabled&&(i._enabled=!0,i._events.onEnabled()),i},i.disable=function(){return!0===i._enabled&&(i._enabled=!1,i._events.onDisabled()),i},i.isEnabled=function(){let e=i;do{if(!e._enabled)return!1}while(e=e._owner);return!0},i.isDisabled=function(){return!i.isEnabled()},i.setX=function(e){return i._x=e,i},i.setY=function(e){return i._y=e,i},i.getX=function(){return i._x},i.getY=function(){return i._y},i.getPosition=function(){return[i._x,i._y]},i.getRealX=function(){let e=0,t=i;for(;e+=t._x,t=t._owner;);return e},i.getRealY=function(){let e=0,t=i;for(;e+=t._y,t=t._owner;);return e},i.getRealPosition=function(){let e=0,t=0,n=i;for(;e+=n._x,t+=n._y,n=n._owner;);return[e,t]},i.moveTo=function(e,t){return i._x=e,i._y=t,i},i.moveBy=function(e,t){return i._x+=e,i._y+=t,i},i.setWidth=function(e){return i._width=e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.setHeight=function(e){return i._height=e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.getWidth=function(){return i._width},i.getHeight=function(){return i._height},i.getSize=function(){return[i._width,i._height]},i.setSize=function(e,t){return i._width=e,i._height=t,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.growByWidth=function(e){return i._x-=e,i._width+=2*e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.shrinkByWidth=function(e){i.growByWidth(-e)},i.growByHeight=function(e){return i._y-=e,i._height+=2*e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.shrinkByHeight=function(e){i.growByHeight(-e)},i.growBy=function(e){return i._x-=e,i._width+=2*e,i._y-=e,i._height+=2*e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i},i.shrinkBy=function(e){return i.growBy(-e)},i.resetX=function(){return i.setX(c(e.x,0)),i},i.resetY=function(){return i.setY(c(e.y,0)),i},i.resetPosition=function(){return i.resetX().resetY()},i.resetWidth=function(){return i.setWidth(c(e.width,0)),i},i.resetHeight=function(){return i.setHeight(c(e.height,0)),i},i.resetSize=function(){return i.resetWidth().resetHeight()},i.show=function(){return i._alpha=1,i},i.hide=function(){return i._alpha=0,i},i.setAlpha=function(e){return i._alpha=myst.clamp(e,0,1),i},i.getAlpha=function(){return i._alpha},i.isVisible=function(){let e=i;do{if(e._alpha<=0)return!1}while(e=e._owner);return!0},i.centerX=function(){var e=i._owner?i._owner._width:i._context.surface.width;return i.setX(Math.floor((e-i._width)/2)),i},i.centerY=function(){var e=i._owner?i._owner._height:i._context.surface.height;return i.setY(Math.floor((e-i._height)/2)),i},i.center=function(){return i.centerX().centerY()},i.setAngle=function(e){return i._angle=e,i},i.getAngle=function(){return i._angle},i.setBackground=function(e){return e&&(i._background=e,i._surface.setFillClearMethod(e),i._requestRepaint=!0),i},i.removeBackground=function(){return i._background=null,i._surface.setDefaultClearMethod(),i._requestRepaint=!0,i},i.getBackground=function(){return i._background},i.setZIndex=function(e){return i._zIndex=e,null!==i._owner&&i._owner._reorderRenderList instanceof Function&&i._owner._reorderRenderList(),i},i.getZIndex=function(){return i._zIndex},i.forceRepaint=function(){i._requestRepaint=!0},i.draw=function(){(i._alwaysRepaint||i._requestRepaint)&&(i._surface.clear(),i._events.onRepaint(),i._requestRepaint=!1);var e,t,n=i.getAlpha();n<=0||(0!==i._angle&&(e=Math.floor(i._x+i._width/2),t=Math.floor(i._y+i._height/2),i._context.paint.rotate(i._angle,[e,t])),n<1&&i._context.paint.setAlpha(n),i._context.paint.graphics(i._texSurface,i._x,i._y),n<1&&i._context.paint.setAlpha(),0!==i._angle&&i._context.paint.restore())},e.background&&i.setBackground(e.background)},Debuggable:function(e,o){o=o||this;let r="";function t(){r="";for(let e=0;e<debugWatch.length;e++)r+=o[debugWatch[e]]+" "}if(e.debug){e.debugString&&e.debugString.replace(/\$/g,"_").split(" ");let n=e.debugColor||"#c2f",i=(setTimeout(t,5),setInterval(t,100),o.draw);o.draw=function(){var e,t;i(),0!==o._angle&&(e=Math.floor(o._x+o._width/2),t=Math.floor(o._y+o._height/2),o._context.paint.rotate(o._angle,[e,t])),o._context.paint.text(r,o._x,o._y-15,n,"left","11px sans-serif"),o._context.paint.rect(o._x,o._y,o._width,o._height,n,2),0!==o._angle&&o._context.paint.restore()}}},Tweenable:function(e,l){let _=[],i=null;l.tween=function(e,r){let s=c((r=r||{}).duration,240),a=c(r.ease,myst.ease.quadInOut);var t=c(r.delay,0);function n(){_.forEach(function(e){e.isActive()&&e.finish()}),_=[],i&&(clearTimeout(i),i=null),myst.iter(e,function(e,t,n){var i=e.charAt(0).toUpperCase()+e.slice(1),o=l["get"+i];o instanceof Function?(o=o(),i=l["set"+i],n=0===n?function(){u(r.onDone,l)}:null,o=new myst.Tween(o,t,s,i,n,a),_.push(o),o.start()):console.error('"'+e+'" is not a valid tween property.')})}return 0===t?n():setTimeout(n,t),l},l.fadeOut=function(e){l.tween({alpha:0},e)},l.fadeIn=function(e){l.tween({alpha:1},e)},l.fadeTo=function(e,t){l.tween({alpha:e},t)}},Graphics:function(e,t){(t=t||this)._texGraphic=e.texture,t._events.onRepaint=function(){t.paint.graphics(t._texGraphic,0,0,t._width,t._height)}},Tile:function(e,t){(t=t||this)._texTileset=e.texture,t._tileWidth=e.tileWidth||t._width,t._tileHeight=e.tileHeight||t._height,t._activeTile=c(e.tile,[0,0]),t._events.onRepaint=function(){t.paint.stretchTile(t._texTileset,0,0,t._tileWidth,t._tileHeight,t._activeTile[0]*t._tileWidth,t._activeTile[1]*t._tileHeight,t._width,t._height)}},AbstractButton:function(e,r){r=r||this;let t="_@"+o();function n(t){let n=r;for(var i,e,o=[];o.push(n),n=n._owner;);for(let e=o.length-1;0<=e;e--)0!==(n=o[e])._angle&&(i=[Math.floor(n.getRealX()+n._width/2),Math.floor(n.getRealY()+n._height/2)],t=myst.rotatePoint(t[0],t[1],i[0],i[1],-n._angle));return e=t,myst.pointInRect(e[0],e[1],r.getRealX(),r.getRealY(),r._width,r._height)}r._events.onPress=C_EMPTYF,r._events.onRelease=C_EMPTYF,r._events.onClick=C_EMPTYF,r._holding=!1,r._pressed=!1,i.on("press",function(e){r.isEnabled()&&r.isVisible()&&n(e)&&(r._holding=r._pressed=!0,r._events.onPress(e))},t).bindTo(r._rootContext),i.on("move",function(e){var t;r._holding&&r.isEnabled()&&r.isVisible()&&r._pressed!==(t=n(e))&&((r._pressed=t)?r._events.onPress(e):r._pressed||r._events.onRelease(e))},t).bindTo(r._rootContext),i.on("release",function(e){var t;r._holding&&r.isEnabled()&&r.isVisible()&&(t=r._pressed,r._holding=r._pressed=!1,t)&&(r._events.onRelease(e),r._events.onClick(e))},t).bindTo(r._rootContext),r._detachListeners=function(){t&&(i.off("press",t),i.off("move",t),i.off("release",t))}},Container:function(e,i){function t(e,t){return e._zIndex-t._zIndex}(i=i||this)._componentList=[],i._componentKeys=[],i._renderList=[],i._reorderRenderList=function(){i._renderList.sort(t)},i._rebuildRenderList=function(){i._renderList=i._componentList.slice(),i._renderList.sort(t)},i.addComponents=function(e){return myst.iter(e,function(e,t){i[e]?console.error('Cannot add component "'+e+'" due to a name clash.'):null!==t._owner?console.error('Cannot add "'+e+'", component is owned.'):(i._componentList.push(i[e]=t),i._componentKeys.push(e),t._context=t._owner=i,t._rootContext=i._rootContext,t._events.onAdded&&t._events.onAdded())}),i._rebuildRenderList(),i},i.getComponents=function(){return i._componentList},i.getComponentKeys=function(){return i._componentKeys},i.remove=function(e){var t,n=i._componentKeys.indexOf(e);-1===n?console.error('Cannot remove "'+e+'", component not found.'):((t=i._componentList[n])._detachListeners&&t._detachListeners(),t.removeAll&&t.removeAll(),t._events.onRemoved&&t._events.onRemoved(),delete i[e],i._componentList.splice(n,1),i._componentKeys.splice(n,1),i._rebuildRenderList())},i.removeAll=function(){return i._componentList.forEach(function(e){e._detachListeners&&e._detachListeners(),e.removeAll&&e.removeAll(),e._events.onRemoved&&e._events.onRemoved()}),i._componentKeys.forEach(function(e){delete i[e]}),i._componentList=[],i._componentKeys=[],i._renderList=[],i},e.components&&i.addComponents(e.components)}},s={Control:function(e,t){t=t||this,e=e||{},myst.compose(t,new r.Base(e,t),new r.Debuggable(e,t),new r.Tweenable(e,t)),t._type="Control"},Frame:function(e,n){n=n||this,e=e||{},myst.compose(n,new s.Control(e,n),new r.Container(e,n)),n._type="Frame",n._events.onRepaint=function(){var t=n._renderList.length;for(let e=0;e<t;e++)n._renderList[e].draw()},n._alwaysRepaint=!0},Shape:function(e,c){c=c||this,e=e||{},myst.compose(c,new s.Control(e,c)),c._type="Shape";let u={rectangle:1,line:2,triangle:3,polygon:4,circle:5,arc:6,pie:7},n=(c._shapeRealUnits=null,c._shapeColor=null,c._shapeFill=null,c._shapeBorder=null,c._shapeType=null,c._shapeGeometry=null,c._shapeRadius=null,c._shapeParameters=null,u.rectangle);c.setShape=function(e){e=e||{},c._requestRepaint=!0,void 0!==e.realUnits?c._shapeRealUnits=Boolean(e.realUnits):null===c._shapeRealUnits&&(c._shapeRealUnits=!1),void 0!==e.color?c._shapeColor=e.color:null===c._shapeColor&&(c._shapeColor="#000"),void 0!==e.fill?c._shapeFill=Boolean(e.fill):null===c._shapeFill&&(c._shapeFill=!0),void 0!==e.border?c._shapeBorder=Math.max(0,parseInt(e.border,10)):null===c._shapeBorder&&(c._shapeBorder=1),c._shapeBorder=void 0!==e.border?parseInt(e.border,10):1;var t=c._shapeType,t=(c._shapeType=u[e.type]||n,c._shapeType!==t);return void 0!==e.geometry?c._shapeGeometry=e.geometry:null!==c._shapeGeometry&&!t||(c._shapeGeometry=function(){switch(c._shapeType){case u.rectangle:return[[0,0],[1,1]];case u.line:return[[0,0],[1,0]];case u.triangle:case u.polygon:return[[0,1],[.5,0],[1,1]];case u.circle:case u.arc:case u.pie:return[[.5,.5]];default:return[]}}()),void 0!==e.radius?c._shapeRadius=e.radius:null===c._shapeRadius&&(c._shapeRadius=function(){switch(c._shapeType){case u.circle:case u.arc:case u.pie:return.5;default:return 0}}()),void 0!==e.parameters?c._shapeParameters=e.parameters:null===c._shapeParameters&&(c._shapeParameters=function(){switch(c._shapeType){case u.arc:case u.pie:return[-90,0];default:return[]}}()),c},c._events.onRepaint=function(){if(c._shapeGeometry instanceof Array){let s=c._shapeGeometry.length,a=c._shapeType,l=c._shapeFill;var e=c._shapeColor;let _=c._shapeBorder;var t=c._shapeParameters,n=c._shapeRealUnits?c._shapeGeometry:function(t){var n=[],i=c.getWidth(),o=c.getHeight();for(let e=0;e<s;e++){var r=t[e];if(r instanceof Array&&2===r.length){let e=r[0]*i,t=r[1]*o;(!l||l&&a===u.line)&&(e=myst.clamp(e,_,i-_),t=myst.clamp(t,_,o-_)),n.push([e,t])}}return n}(c._shapeGeometry),i=c._shapeRealUnits?c._shapeRadius:function(t){var e=c.getWidth(),n=c.getHeight(),i=Math.min(e,n);if(t instanceof Array){var o=[],r=t.length;for(let e=0;e<r;e++)o.push(t[e]*i);return o}{let e=t*i;return e=l||a!==u.circle&&a!==u.arc&&a!=u.pie?e:myst.clamp(2*e,_,i-_)/2}}(c._shapeRadius);switch(a){case u.rectangle:s<2||(l?c.paint.rectFill(n[0][0],n[0][1],n[1][0]-n[0][0],n[1][1]-n[0][1],e,i):c.paint.rect(n[0][0],n[0][1],n[1][0]-n[0][0],n[1][1]-n[0][1],e,_,i));break;case u.line:s<2||c.paint.line(n[0][0],n[0][1],n[1][0],n[1][1],e,_);break;case u.triangle:3<s&&n.splice(3);case u.polygon:s<3||(l?c.paint.polygonFill(n,e):c.paint.polygon(n,e,_));break;case u.circle:s<1||(l?c.paint.circleFill(n[0][0],n[0][1],i,e):c.paint.circle(n[0][0],n[0][1],i,e,_));break;case u.arc:s<1||(c._shapeFill?c.paint.arcFill(n[0][0],n[0][1],i,t[0],t[1],e):c.paint.arc(n[0][0],n[0][1],i,t[0],t[1],e,_));break;case u.pie:s<1||(c._shapeFill?c.paint.sectorFill(n[0][0],n[0][1],i,t[0],t[1],e):c.paint.sector(n[0][0],n[0][1],i,t[0],t[1],e,_))}}},c.setShape(e)},Image:function(e,t){t=t||this,(e=e||{}).width=c(e.width,e.texture.width),e.height=c(e.height,e.texture.height),myst.compose(t,new s.Control(e,t),new r.Graphics(e,t)),t._type="Image"},TileImage:function(e,t){t=t||this,e=e||{},myst.compose(t,new s.Control(e,t),new r.Tile(e,t)),t._type="TileImage",t.setTile=function(e){e instanceof Array&&2<=e.length&&(t._activeTile=e,t._requestRepaint=!0)}},Label:function(e,t){t=t||this,e=e||{},myst.compose(t,new s.Control(e,t)),t._type="Label",t._autoResize=c(e.autoResize,!1),t._text=c(e.text,""),t.setText=function(e){},t._events.onRepaint=function(){},t.setText(e.text)},LinkLabel:function(e,t){},BitmapLabel:function(e,t){t=t||this,e=e||{},myst.compose(t,new s.Control(e,t)),t._type="BitmapLabel"},TileButton:function(e,t){t=t||this,e=e||{},myst.compose(t,new s.Control(e,t),new r.Tile(e,t),new r.AbstractButton(e,t)),t._type="TileButton",e.tiles=e.tiles||{};let n=e.tiles.normal||[0,0],i=e.tiles.pressed||[0,0],o=e.tiles.disabled||[0,0];t._activeTile=n,t._events.onPress=function(){t._activeTile=i,t._requestRepaint=!0,u(e.onPress,t)},t._events.onRelease=function(){t._activeTile=n,t._requestRepaint=!0,u(e.onRelease,t)},t._events.onClick=function(){u(e.onClick,t)},t._events.onEnabled=function(){t._activeTile=n,t._requestRepaint=!0,u(e.onEnabled,t)},t._events.onDisabled=function(){t._activeTile=o,t._requestRepaint=!0,u(e.onDisabled,t)}},GraphicButton:function(){},ToggleButton:function(){},StateBox:function(){},CheckBox:function(){},OptionBox:function(){}};return myst.compose({atomic:r},s,{init:function(e){i=e},applyToGroup:function(e,n,i){null!=i&&(i=i instanceof Array?i:[i]),myst.iter(e,function(e,t){t[n]instanceof Function&&t[n].apply(t,i)})},createTile:function(e,t,n,i,o){var r=new myst.Surface({width:i,height:o});return r.render.tile(e,0,0,i,o,t,n),r.canvas},delayedAction:function(e,t){setTimeout(t,e)},setGlobalContext:function(e){t=e}})}();
/* myst.ui.js 0.2.3
 * (c) 2021 Danijel Durakovic
 * MIT License */
myst.ui=function(){"use strict";var e,i=null,t=null,r=(e=0,function(){return++e});function l(e,t){return null!=e?e:t}function u(e,t){e instanceof Function&&e.call(t)}var o={Base:function(e,i){(i=i||this)._x=l(e.x,0),i._y=l(e.y,0),i._width=l(e.width,0),i._height=l(e.height,0),i._alpha=l(e.alpha,1),i._angle=l(e.angle,0),i._background=null,i._zIndex=l(e.zIndex,0),i._enabled=Boolean(l(e.enabled,!0)),i._context=l(e.context,t),i._rootContext=i.context,i._owner=null,i._requestRepaint=!0,i._alwaysRepaint=!1,i._surface=new myst.Surface({width:i._width,height:i._height}),i._texSurface=i._surface.canvas,i._events={},i._events.onRepaint=C_EMPTYF,i._events.onAdded=function(){u(e.onAdded,i)},i._events.onRemoved=function(){u(e.onRemoved,i)},i._events.onResized=function(){u(e.onResized,i)},i._events.onEnabled=function(){u(e.onEnabled,i)},i._events.onDisabled=function(){u(e.onDisabled,i)},i.paint=i._surface.render,i.enable=function(){return!1===i._enabled&&(i._enabled=!0,i._events.onEnabled()),i},i.disable=function(){return!0===i._enabled&&(i._enabled=!1,i._events.onDisabled()),i},i.isEnabled=function(){var e=i;do{if(!e._enabled)return!1}while(e=e._owner);return!0},i.isDisabled=function(){return!i.isEnabled()},i.setX=function(e){return i._x=e,i},i.setY=function(e){return i._y=e,i},i.getX=function(){return i._x},i.getY=function(){return i._y},i.getPosition=function(){return[i._x,i._y]},i.getRealX=function(){for(var e=0,t=i;e+=t._x,t=t._owner;);return e},i.getRealY=function(){for(var e=0,t=i;e+=t._y,t=t._owner;);return e},i.getRealPosition=function(){for(var e=0,t=0,n=i;e+=n._x,t+=n._y,n=n._owner;);return[e,t]},i.moveTo=function(e,t){return i._x=e,i._y=t,i},i.moveBy=function(e,t){return i._x+=e,i._y+=t,i},i.setWidth=function(e){return i._width=e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.setHeight=function(e){return i._height=e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.getWidth=function(){return i._width},i.getHeight=function(){return i._height},i.getSize=function(){return[i._width,i._height]},i.setSize=function(e,t){return i._width=e,i._height=t,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.growByWidth=function(e){return i._x-=e,i._width+=2*e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.shrinkByWidth=function(e){i.growByWidth(-e)},i.growByHeight=function(e){return i._y-=e,i._height+=2*e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.shrinkByHeight=function(e){i.growByHeight(-e)},i.growBy=function(e){return i._x-=e,i._width+=2*e,i._y-=e,i._height+=2*e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i},i.shrinkBy=function(e){return i.growBy(-e)},i.resetX=function(){return i.setX(l(e.x,0)),i},i.resetY=function(){return i.setY(l(e.y,0)),i},i.resetPosition=function(){return i.resetX().resetY()},i.resetWidth=function(){return i.setWidth(l(e.width,0)),i},i.resetHeight=function(){return i.setHeight(l(e.height,0)),i},i.resetSize=function(){return i.resetWidth().resetHeight()},i.show=function(){return i._alpha=1,i},i.hide=function(){return i._alpha=0,i},i.setAlpha=function(e){return i._alpha=myst.clamp(e,0,1),i},i.getAlpha=function(){return i._alpha},i.isVisible=function(){var e=i;do{if(e._alpha<=0)return!1}while(e=e._owner);return!0},i.centerX=function(){var e=i._owner?i._owner._width:i._context.surface.width;return i.setX(Math.floor((e-i._width)/2)),i},i.centerY=function(){var e=i._owner?i._owner._height:i._context.surface.height;return i.setY(Math.floor((e-i._height)/2)),i},i.center=function(){return i.centerX().centerY()},i.setAngle=function(e){return i._angle=e,i},i.getAngle=function(){return i._angle},i.setBackground=function(e){return e&&(i._background=e,i._surface.setFillClearMethod(e),i._requestRepaint=!0),i},i.removeBackground=function(){return i._background=null,i._surface.setDefaultClearMethod(),i._requestRepaint=!0,i},i.getBackground=function(){return i._background},i.setZIndex=function(e){return i._zIndex=e,null!==i._owner&&i._owner._reorderRenderList instanceof Function&&i._owner._reorderRenderList(),i},i.getZIndex=function(){return i._zIndex},i.forceRepaint=function(){i._requestRepaint=!0},i.draw=function(){(i._alwaysRepaint||i._requestRepaint)&&(i._surface.clear(),i._events.onRepaint(),i._requestRepaint=!1);var e,t,n=i.getAlpha();n<=0||(0!==i._angle&&(e=Math.floor(i._x+i._width/2),t=Math.floor(i._y+i._height/2),i._context.paint.rotate(i._angle,[e,t])),n<1&&i._context.paint.setAlpha(n),i._context.paint.graphics(i._texSurface,i._x,i._y),n<1&&i._context.paint.setAlpha(),0!==i._angle&&i._context.paint.restore())},e.background&&i.setBackground(e.background)},Debuggable:function(e,n){n=n||this;var t,i,r,o="";function a(){o="";for(var e=0;e<t.length;e++)o+=n[t[e]]+" "}e.debug&&(t=e.debugString?e.debugString.replace(/\$/g,"_").split(" "):["_type"],i=e.debugColor||"#c2f",setTimeout(a,5),setInterval(a,100),r=n.draw,n.draw=function(){var e,t;r(),0!==n._angle&&(e=Math.floor(n._x+n._width/2),t=Math.floor(n._y+n._height/2),n._context.paint.rotate(n._angle,[e,t])),n._context.paint.text(o,n._x,n._y-15,i,"left","11px sans-serif"),n._context.paint.rect(n._x,n._y,n._width,n._height,i,2),0!==n._angle&&n._context.paint.restore()})},Tweenable:function(e,_){var c=[],i=null;_.tween=function(e,o){var a=l((o=o||{}).duration,240),s=l(o.ease,myst.ease.quadInOut),t=l(o.delay,0);function n(){c.forEach(function(e){e.isActive()&&e.finish()}),c=[],i&&(clearTimeout(i),i=null),myst.iter(e,function(e,t,n){var i=e.charAt(0).toUpperCase()+e.slice(1),r=_["get"+i];r instanceof Function?(r=r(),i=_["set"+i],n=0===n?function(){u(o.onDone,_)}:null,n=new myst.Tween(r,t,a,i,n,s),c.push(n),n.start()):console.error('"'+e+'" is not a valid tween property.')})}return 0===t?n():setTimeout(n,t),_},_.fadeOut=function(e){_.tween({alpha:0},e)},_.fadeIn=function(e){_.tween({alpha:1},e)},_.fadeTo=function(e,t){_.tween({alpha:e},t)}},Graphics:function(e,t){(t=t||this)._texGraphic=e.texture,t._events.onRepaint=function(){t.paint.graphics(t._texGraphic,0,0,t._width,t._height)}},Tile:function(e,t){(t=t||this)._texTileset=e.texture,t._tileWidth=e.tileWidth||t._width,t._tileHeight=e.tileHeight||t._height,t._activeTile=l(e.tile,[0,0]),t._events.onRepaint=function(){t.paint.stretchTile(t._texTileset,0,0,t._tileWidth,t._tileHeight,t._activeTile[0]*t._tileWidth,t._activeTile[1]*t._tileHeight,t._width,t._height)}},AbstractButton:function(e,a){a=a||this;var t="_@"+r();function n(e){for(var t=a,n=[];n.push(t),t=t._owner;);for(var i,r,o=n.length-1;0<=o;o--)0!==(t=n[o])._angle&&(i=[Math.floor(t.getRealX()+t._width/2),Math.floor(t.getRealY()+t._height/2)],e=myst.rotatePoint(e[0],e[1],i[0],i[1],-t._angle));return r=e,myst.pointInRect(r[0],r[1],a.getRealX(),a.getRealY(),a._width,a._height)}a._events.onPress=C_EMPTYF,a._events.onRelease=C_EMPTYF,a._events.onClick=C_EMPTYF,a._holding=!1,a._pressed=!1,i.on("press",function(e){a.isEnabled()&&a.isVisible()&&n(e)&&(a._holding=a._pressed=!0,a._events.onPress(e))},t).bindTo(a._rootContext),i.on("move",function(e){var t;a._holding&&a.isEnabled()&&a.isVisible()&&(a._pressed!==(t=n(e))&&((a._pressed=t)?a._events.onPress(e):a._pressed||a._events.onRelease(e)))},t).bindTo(a._rootContext),i.on("release",function(e){var t;a._holding&&a.isEnabled()&&a.isVisible()&&(t=a._pressed,a._holding=a._pressed=!1,t&&(a._events.onRelease(e),a._events.onClick(e)))},t).bindTo(a._rootContext),a._detachListeners=function(){t&&(i.off("press",t),i.off("move",t),i.off("release",t))}},Container:function(e,i){function t(e,t){return e._zIndex-t._zIndex}(i=i||this)._componentList=[],i._componentKeys=[],i._renderList=[],i._reorderRenderList=function(){i._renderList.sort(t)},i._rebuildRenderList=function(){i._renderList=i._componentList.slice(),i._renderList.sort(t)},i.addComponents=function(e){return myst.iter(e,function(e,t){i[e]?console.error('Cannot add component "'+e+'" due to a name clash.'):null===t._owner?(i._componentList.push(i[e]=t),i._componentKeys.push(e),t._context=t._owner=i,t._rootContext=i._rootContext,t._events.onAdded&&t._events.onAdded()):console.error('Cannot add "'+e+'", component is owned.')}),i._rebuildRenderList(),i},i.getComponents=function(){return i._componentList},i.getComponentKeys=function(){return i._componentKeys},i.remove=function(e){var t,n=i._componentKeys.indexOf(e);-1!==n?((t=i._componentList[n])._detachListeners&&t._detachListeners(),t.removeAll&&t.removeAll(),t._events.onRemoved&&t._events.onRemoved(),delete i[e],i._componentList.splice(n,1),i._componentKeys.splice(n,1),i._rebuildRenderList()):console.error('Cannot remove "'+e+'", component not found.')},i.removeAll=function(){return i._componentList.forEach(function(e){e._detachListeners&&e._detachListeners(),e.removeAll&&e.removeAll(),e._events.onRemoved&&e._events.onRemoved()}),i._componentKeys.forEach(function(e){delete i[e]}),i._componentList=[],i._componentKeys=[],i._renderList=[],i},e.components&&i.addComponents(e.components)}},a={Control:function(e,t){t=t||this,e=e||{},myst.compose(t,new o.Base(e,t),new o.Debuggable(e,t),new o.Tweenable(e,t)),t._type="Control"},Frame:function(e,n){n=n||this,e=e||{},myst.compose(n,new a.Control(e,n),new o.Container(e,n)),n._type="Frame",n._events.onRepaint=function(){for(var e=n._renderList.length,t=0;t<e;t++)n._renderList[t].draw()},n._alwaysRepaint=!0},Shape:function(e,u){u=u||this,e=e||{},myst.compose(u,new a.Control(e,u)),u._type="Shape";var h={rectangle:1,line:2,triangle:3,polygon:4,circle:5,arc:6,pie:7};u._shapeRealUnits=null,u._shapeColor=null,u._shapeFill=null,u._shapeBorder=null,u._shapeType=null,u._shapeGeometry=null,u._shapeRadius=null,u._shapeParameters=null;var n=h.rectangle;u.setShape=function(e){e=e||{},u._requestRepaint=!0,void 0!==e.realUnits?u._shapeRealUnits=Boolean(e.realUnits):null===u._shapeRealUnits&&(u._shapeRealUnits=!1),void 0!==e.color?u._shapeColor=e.color:null===u._shapeColor&&(u._shapeColor="#000"),void 0!==e.fill?u._shapeFill=Boolean(e.fill):null===u._shapeFill&&(u._shapeFill=!0),void 0!==e.border?u._shapeBorder=Math.max(0,parseInt(e.border,10)):null===u._shapeBorder&&(u._shapeBorder=1),u._shapeBorder=void 0!==e.border?parseInt(e.border,10):1;var t=u._shapeType;u._shapeType=h[e.type]||n;t=u._shapeType!==t;return void 0!==e.geometry?u._shapeGeometry=e.geometry:null!==u._shapeGeometry&&!t||(u._shapeGeometry=function(){switch(u._shapeType){case h.rectangle:return[[0,0],[1,1]];case h.line:return[[0,0],[1,0]];case h.triangle:case h.polygon:return[[0,1],[.5,0],[1,1]];case h.circle:case h.arc:case h.pie:return[[.5,.5]];default:return[]}}()),void 0!==e.radius?u._shapeRadius=e.radius:null===u._shapeRadius&&(u._shapeRadius=function(){switch(u._shapeType){case h.circle:case h.arc:case h.pie:return.5;default:return 0}}()),void 0!==e.parameters?u._shapeParameters=e.parameters:null===u._shapeParameters&&(u._shapeParameters=function(){switch(u._shapeType){case h.arc:case h.pie:return[-90,0];default:return[]}}()),u},u._events.onRepaint=function(){if(u._shapeGeometry instanceof Array){var s=u._shapeGeometry.length,_=u._shapeType,c=u._shapeFill,e=u._shapeColor,l=u._shapeBorder,t=u._shapeParameters,n=u._shapeRealUnits?u._shapeGeometry:function(e){for(var t=[],n=u.getWidth(),i=u.getHeight(),r=0;r<s;r++){var o,a=e[r];a instanceof Array&&2===a.length&&(o=a[0]*n,a=a[1]*i,(!c||c&&_===h.line)&&(o=myst.clamp(o,l,n-l),a=myst.clamp(a,l,i-l)),t.push([o,a]))}return t}(u._shapeGeometry),i=u._shapeRealUnits?u._shapeRadius:function(e){var t=u.getWidth(),n=u.getHeight(),i=Math.min(t,n);if(e instanceof Array){for(var r=[],o=e.length,a=0;a<o;a++)r.push(e[a]*i);return r}return n=e*i,n=!(c||_!==h.circle&&_!==h.arc&&_!=h.pie)?myst.clamp(2*n,l,i-l)/2:n}(u._shapeRadius);switch(_){case h.rectangle:if(s<2)return;c?u.paint.rectFill(n[0][0],n[0][1],n[1][0]-n[0][0],n[1][1]-n[0][1],e,i):u.paint.rect(n[0][0],n[0][1],n[1][0]-n[0][0],n[1][1]-n[0][1],e,l,i);break;case h.line:if(s<2)return;u.paint.line(n[0][0],n[0][1],n[1][0],n[1][1],e,l);break;case h.triangle:3<s&&n.splice(3);case h.polygon:if(s<3)return;c?u.paint.polygonFill(n,e):u.paint.polygon(n,e,l);break;case h.circle:if(s<1)return;c?u.paint.circleFill(n[0][0],n[0][1],i,e):u.paint.circle(n[0][0],n[0][1],i,e,l);break;case h.arc:if(s<1)return;u._shapeFill?u.paint.arcFill(n[0][0],n[0][1],i,t[0],t[1],e):u.paint.arc(n[0][0],n[0][1],i,t[0],t[1],e,l);break;case h.pie:if(s<1)return;u._shapeFill?u.paint.sectorFill(n[0][0],n[0][1],i,t[0],t[1],e):u.paint.sector(n[0][0],n[0][1],i,t[0],t[1],e,l)}}},u.setShape(e)},Image:function(e,t){t=t||this,(e=e||{}).width=l(e.width,e.texture.width),e.height=l(e.height,e.texture.height),myst.compose(t,new a.Control(e,t),new o.Graphics(e,t)),t._type="Image"},TileImage:function(e,t){t=t||this,e=e||{},myst.compose(t,new a.Control(e,t),new o.Tile(e,t)),t._type="TileImage",t.setTile=function(e){e instanceof Array&&2<=e.length&&(t._activeTile=e,t._requestRepaint=!0)}},Label:function(e,t){t=t||this,e=e||{},myst.compose(t,new a.Control(e,t)),t._type="Label",t._autoResize=l(e.autoResize,!1),t._text=l(e.text,""),t.setText=function(e){},t._events.onRepaint=function(){},t.setText(e.text)},LinkLabel:function(e,t){},BitmapLabel:function(e,t){t=t||this,e=e||{},myst.compose(t,new a.Control(e,t)),t._type="BitmapLabel"},TileButton:function(e,t){t=t||this,e=e||{},myst.compose(t,new a.Control(e,t),new o.Tile(e,t),new o.AbstractButton(e,t)),t._type="TileButton",e.tiles=e.tiles||{};var n=e.tiles.normal||[0,0],i=e.tiles.pressed||[0,0],r=e.tiles.disabled||[0,0];t._activeTile=n,t._events.onPress=function(){t._activeTile=i,t._requestRepaint=!0,u(e.onPress,t)},t._events.onRelease=function(){t._activeTile=n,t._requestRepaint=!0,u(e.onRelease,t)},t._events.onClick=function(){u(e.onClick,t)},t._events.onEnabled=function(){t._activeTile=n,t._requestRepaint=!0,u(e.onEnabled,t)},t._events.onDisabled=function(){t._activeTile=r,t._requestRepaint=!0,u(e.onDisabled,t)}},GraphicButton:function(){},ToggleButton:function(){},StateBox:function(){},CheckBox:function(){},OptionBox:function(){}},n={init:function(e){i=e},applyToGroup:function(e,n,i){null!=i&&(i=i instanceof Array?i:[i]),myst.iter(e,function(e,t){t[n]instanceof Function&&t[n].apply(t,i)})},createTile:function(e,t,n,i,r){var o=new myst.Surface({width:i,height:r});return o.render.tile(e,0,0,i,r,t,n),o.canvas},delayedAction:function(e,t){setTimeout(t,e)},setGlobalContext:function(e){t=e}};return myst.compose({atomic:o},a,n)}();
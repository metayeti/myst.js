/* myst.ui.js 0.2.1
 * (c) 2021 Danijel Durakovic
 * MIT License */
myst.ui=function(){"use strict";var e,i=null,t=null,r=(e=0,function(){return++e});function n(e,t){return null!=e?e:t}function c(e,t){e instanceof Function&&e.call(t)}var o={Base:function(e,i){(i=i||this)._x=n(e.x,0),i._y=n(e.y,0),i._width=n(e.width,0),i._height=n(e.height,0),i._alpha=n(e.alpha,1),i._angle=n(e.angle,0),i._background=null,i._zIndex=n(e.zIndex,0),i._enabled=Boolean(n(e.enabled,!0)),i._context=n(e.context,t),i._rootContext=i.context,i._owner=null,i._requestRepaint=!0,i._alwaysRepaint=!1,i._surface=new myst.Surface({width:i._width,height:i._height}),i._texSurface=i._surface.canvas,i._events={},i._events.onRepaint=C_EMPTYF,i._events.onAdded=function(){c(e.onAdded,i)},i._events.onRemoved=function(){c(e.onRemoved,i)},i._events.onResized=function(){c(e.onResized,i)},i._events.onEnabled=function(){c(e.onEnabled,i)},i._events.onDisabled=function(){c(e.onDisabled,i)},i.paint=i._surface.render,i.enable=function(){return!1===i._enabled&&(i._enabled=!0,i._events.onEnabled()),i},i.disable=function(){return!0===i._enabled&&(i._enabled=!1,i._events.onDisabled()),i},i.isEnabled=function(){var e=i;do{if(!e._enabled)return!1}while(e=e._owner);return!0},i.isDisabled=function(){return!i.isEnabled()},i.setX=function(e){return i._x=e,i},i.setY=function(e){return i._y=e,i},i.getX=function(){return i._x},i.getY=function(){return i._y},i.getPosition=function(){return[i._x,i._y]},i.getRealX=function(){for(var e=0,t=i;e+=t._x,t=t._owner;);return e},i.getRealY=function(){for(var e=0,t=i;e+=t._y,t=t._owner;);return e},i.getRealPosition=function(){for(var e=0,t=0,n=i;e+=n._x,t+=n._y,n=n._owner;);return[e,t]},i.moveTo=function(e,t){return i._x=e,i._y=t,i},i.moveBy=function(e,t){return i._x+=e,i._y+=t,i},i.setWidth=function(e){return i._width=e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.setHeight=function(e){return i._height=e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.getWidth=function(){return i._width},i.getHeight=function(){return i._height},i.getSize=function(){return[i._width,i._height]},i.setSize=function(e,t){return i._width=e,i._height=t,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.growByWidth=function(e){return i._x-=e,i._width+=2*e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.shrinkByWidth=function(e){i.growByWidth(-e)},i.growByHeight=function(e){return i._y-=e,i._height+=2*e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i._events.onResized(),i},i.shrinkByHeight=function(e){i.growByHeight(-e)},i.growBy=function(e){return i._x-=e,i._width+=2*e,i._y-=e,i._height+=2*e,i._surface.resize(i._width,i._height),i._requestRepaint=!0,i},i.shrinkBy=function(e){return i.growBy(-e)},i.resetX=function(){return i.setX(n(e.x,0)),i},i.resetY=function(){return i.setY(n(e.y,0)),i},i.resetPosition=function(){return i.resetX().resetY()},i.resetWidth=function(){return i.setWidth(n(e.width,0)),i},i.resetHeight=function(){return i.setHeight(n(e.height,0)),i},i.resetSize=function(){return i.resetWidth().resetHeight()},i.show=function(){return i._alpha=1,i},i.hide=function(){return i._alpha=0,i},i.setAlpha=function(e){return i._alpha=myst.clamp(e,0,1),i},i.getAlpha=function(){return i._alpha},i.isVisible=function(){var e=i;do{if(e._alpha<=0)return!1}while(e=e._owner);return!0},i.centerX=function(){var e=i._owner?i._owner._width:i._context.surface.width;return i.setX(Math.floor((e-i._width)/2)),i},i.centerY=function(){var e=i._owner?i._owner._height:i._context.surface.height;return i.setY(Math.floor((e-i._height)/2)),i},i.center=function(){return i.centerX().centerY()},i.setAngle=function(e){return i._angle=e,i},i.getAngle=function(){return i._angle},i.setBackground=function(e){return e&&(i._background=e,i._surface.setFillClearMethod(e),i._requestRepaint=!0),i},i.removeBackground=function(){return i._background=null,i._surface.setDefaultClearMethod(),i._requestRepaint=!0,i},i.getBackground=function(){return i._background},i.setZIndex=function(e){return i._zIndex=e,null!==i._owner&&i._owner._reorderRenderList instanceof Function&&i._owner._reorderRenderList(),i},i.getZIndex=function(){return i._zIndex},i.forceRepaint=function(){i._requestRepaint=!0},i.draw=function(){(i._alwaysRepaint||i._requestRepaint)&&(i._surface.clear(),i._events.onRepaint(),i._requestRepaint=!1);var e,t,n=i.getAlpha();n<=0||(0!==i._angle&&(e=Math.floor(i._x+i._width/2),t=Math.floor(i._y+i._height/2),i._context.paint.rotate(i._angle,[e,t])),n<1&&i._context.paint.setAlpha(n),i._context.paint.graphics(i._texSurface,i._x,i._y),n<1&&i._context.paint.setAlpha(),0!==i._angle&&i._context.paint.restore())},e.background&&i.setBackground(e.background)},Debuggable:function(e,n){n=n||this;var t,i,r,o="";function a(){o="";for(var e=0;e<t.length;e++)o+=n[t[e]]+" "}e.debug&&(t=e.debugString?e.debugString.replace(/\$/g,"_").split(" "):["_type"],i=e.debugColor||"#c2f",setTimeout(a,5),setInterval(a,100),r=n.draw,n.draw=function(){var e,t;r(),0!==n._angle&&(e=Math.floor(n._x+n._width/2),t=Math.floor(n._y+n._height/2),n._context.paint.rotate(n._angle,[e,t])),n._context.paint.text(o,n._x,n._y-15,i,"left","11px sans-serif"),n._context.paint.rect(n._x,n._y,n._width,n._height,i,2),0!==n._angle&&n._context.paint.restore()})},Tweenable:function(e,s){var _=[];s.tween=function(e,r){var o=n((r=r||{}).duration,240),a=n(r.ease,myst.ease.quadInOut);return _.forEach(function(e){e.isActive()&&e.finish()}),_=[],myst.iter(e,function(e,t){var n=e.charAt(0).toUpperCase()+e.slice(1),i=s["get"+n];i instanceof Function?(i=i(),n=s["set"+n],n=new myst.Tween(i,t,o,n,function(){c(r.onDone,s)},a),_.push(n),n.start()):console.error('"'+e+'" is not a valid tween property.')}),s},s.fadeOut=function(e){s.tween({alpha:0},e)},s.fadeIn=function(e){s.tween({alpha:1},e)},s.fadeTo=function(e,t){s.tween({alpha:e},t)}},Graphics:function(e,t){(t=t||this)._texGraphic=e.texture,t._events.onRepaint=function(){t.paint.graphics(t._texGraphic,0,0,t._width,t._height)}},Tile:function(e,t){(t=t||this)._texTileset=e.texture,t._tileWidth=e.tileWidth||t._width,t._tileHeight=e.tileHeight||t._height,t._activeTile=n(e.tile,[0,0]),t._events.onRepaint=function(){t.paint.stretchTile(t._texTileset,0,0,t._tileWidth,t._tileHeight,t._activeTile[0]*t._tileWidth,t._activeTile[1]*t._tileHeight,t._width,t._height)}},AbstractButton:function(e,a){a=a||this;var t="_@"+r();function n(e){for(var t=a,n=[];n.push(t),t=t._owner;);for(var i,r,o=n.length-1;0<=o;o--)0!==(t=n[o])._angle&&(i=[Math.floor(t.getRealX()+t._width/2),Math.floor(t.getRealY()+t._height/2)],e=myst.rotatePoint(e[0],e[1],i[0],i[1],-t._angle));return r=e,myst.pointInRect(r[0],r[1],a.getRealX(),a.getRealY(),a._width,a._height)}a._events.onPress=C_EMPTYF,a._events.onRelease=C_EMPTYF,a._events.onClick=C_EMPTYF,a._holding=!1,a._pressed=!1,i.on("press",function(e){a.isEnabled()&&a.isVisible()&&n(e)&&(a._holding=a._pressed=!0,a._events.onPress())},t).bindTo(a._rootContext),i.on("move",function(e){a._holding&&a.isEnabled()&&a.isVisible()&&(a._pressed!==(e=n(e))&&((a._pressed=e)?a._events.onPress():a._pressed||a._events.onRelease()))},t).bindTo(a._rootContext),i.on("release",function(e){var t;a._holding&&a.isEnabled()&&a.isVisible()&&(t=a._pressed,a._holding=a._pressed=!1,t&&(a._events.onRelease(),a._events.onClick()))},t).bindTo(a._rootContext),a._detachListeners=function(){t&&(i.off("press",t),i.off("move",t),i.off("release",t))}},Container:function(e,i){function t(e,t){return e._zIndex-t._zIndex}(i=i||this)._componentList=[],i._componentKeys=[],i._renderList=[],i._reorderRenderList=function(){i._renderList.sort(t)},i._rebuildRenderList=function(){i._renderList=i._componentList.slice(),i._renderList.sort(t)},i.addComponents=function(e){return myst.iter(e,function(e,t){i[e]?console.error('Cannot add component "'+e+'" due to a name clash.'):null===t._owner?(i._componentList.push(i[e]=t),i._componentKeys.push(e),t._context=t._owner=i,t._rootContext=i._rootContext,t._events.onAdded&&t._events.onAdded()):console.error('Cannot add "'+e+'", component is owned.')}),i._rebuildRenderList(),i},i.getComponents=function(){return i._componentList},i.getComponentKeys=function(){return i._componentKeys},i.remove=function(e){var t,n=i._componentKeys.indexOf(e);-1!==n?((t=i._componentList[n])._detachListeners&&t._detachListeners(),t.removeAll&&t.removeAll(),t._events.onRemoved&&t._events.onRemoved(),delete i[e],i._componentList.splice(n,1),i._componentKeys.splice(n,1),i._rebuildRenderList()):console.error('Cannot remove "'+e+'", component not found.')},i.removeAll=function(){return i._componentList.forEach(function(e){e._detachListeners&&e._detachListeners(),e.removeAll&&e.removeAll(),e._events.onRemoved&&e._events.onRemoved()}),i._componentKeys.forEach(function(e){delete i[e]}),i._componentList=[],i._componentKeys=[],i._renderList=[],i},e.components&&i.addComponents(e.components)}},a={Control:function(e,t){t=t||this,e=e||{},myst.compose(t,new o.Base(e,t),new o.Debuggable(e,t),new o.Tweenable(e,t)),t._type="Control"},Frame:function(e,n){n=n||this,e=e||{},myst.compose(n,new a.Control(e,n),new o.Container(e,n)),n._type="Frame",n._events.onRepaint=function(){for(var e=n._renderList.length,t=0;t<e;t++)n._renderList[t].draw()},n._alwaysRepaint=!0},Shape:function(e,l){l=l||this,e=e||{},myst.compose(l,new a.Control(e,l)),l._type="Shape";var h={rectangle:1,line:2,triangle:3,polygon:4,circle:5,arc:6,pie:7};l._shapeRealUnits=null,l._shapeColor=null,l._shapeFill=null,l._shapeBorder=null,l._shapeType=null,l._shapeGeometry=null,l._shapeRadius=null,l._shapeParameters=null;var n=h.rectangle;l.setShape=function(e){e=e||{},l._requestRepaint=!0,void 0!==e.realUnits?l._shapeRealUnits=Boolean(e.realUnits):null===l._shapeRealUnits&&(l._shapeRealUnits=!1),void 0!==e.color?l._shapeColor=e.color:null===l._shapeColor&&(l._shapeColor="#000"),void 0!==e.fill?l._shapeFill=Boolean(e.fill):null===l._shapeFill&&(l._shapeFill=!0),void 0!==e.border?l._shapeBorder=Math.max(0,parseInt(e.border,10)):null===l._shapeBorder&&(l._shapeBorder=1),l._shapeBorder=void 0!==e.border?parseInt(e.border,10):1;var t=l._shapeType;l._shapeType=h[e.type]||n;t=l._shapeType!==t;return void 0!==e.geometry?l._shapeGeometry=e.geometry:null!==l._shapeGeometry&&!t||(l._shapeGeometry=function(){switch(l._shapeType){case h.rectangle:return[[0,0],[1,1]];case h.line:return[[0,0],[1,0]];case h.triangle:case h.polygon:return[[0,1],[.5,0],[1,1]];case h.circle:case h.arc:case h.pie:return[[.5,.5]];default:return[]}}()),void 0!==e.radius?l._shapeRadius=e.radius:null===l._shapeRadius&&(l._shapeRadius=function(){switch(l._shapeType){case h.circle:case h.arc:case h.pie:return.5;default:return 0}}()),void 0!==e.parameters?l._shapeParameters=e.parameters:null===l._shapeParameters&&(l._shapeParameters=function(){switch(l._shapeType){case h.arc:case h.pie:return[-90,0];default:return[]}}()),l},l._events.onRepaint=function(){if(l._shapeGeometry instanceof Array){var s=l._shapeGeometry.length,_=l._shapeType,c=l._shapeFill,e=l._shapeColor,u=l._shapeBorder,t=l._shapeParameters,n=l._shapeRealUnits?l._shapeGeometry:function(e){for(var t=[],n=l.getWidth(),i=l.getHeight(),r=0;r<s;r++){var o,a=e[r];a instanceof Array&&2===a.length&&(o=a[0]*n,a=a[1]*i,(!c||c&&_===h.line)&&(o=myst.clamp(o,u,n-u),a=myst.clamp(a,u,i-u)),t.push([o,a]))}return t}(l._shapeGeometry),i=l._shapeRealUnits?l._shapeRadius:function(e){var t=l.getWidth(),n=l.getHeight(),i=Math.min(t,n);if(e instanceof Array){for(var r=[],o=e.length,a=0;a<o;a++)r.push(e[a]*i);return r}return n=e*i,n=!(c||_!==h.circle&&_!==h.arc&&_!=h.pie)?myst.clamp(2*n,u,i-u)/2:n}(l._shapeRadius);switch(_){case h.rectangle:if(s<2)return;c?l.paint.rectFill(n[0][0],n[0][1],n[1][0]-n[0][0],n[1][1]-n[0][1],e,i):l.paint.rect(n[0][0],n[0][1],n[1][0]-n[0][0],n[1][1]-n[0][1],e,u,i);break;case h.line:if(s<2)return;l.paint.line(n[0][0],n[0][1],n[1][0],n[1][1],e,u);break;case h.triangle:3<s&&n.splice(3);case h.polygon:if(s<3)return;c?l.paint.polygonFill(n,e):l.paint.polygon(n,e,u);break;case h.circle:if(s<1)return;c?l.paint.circleFill(n[0][0],n[0][1],i,e):l.paint.circle(n[0][0],n[0][1],i,e,u);break;case h.arc:if(s<1)return;l._shapeFill?l.paint.arcFill(n[0][0],n[0][1],i,t[0],t[1],e):l.paint.arc(n[0][0],n[0][1],i,t[0],t[1],e,u);break;case h.pie:if(s<1)return;l._shapeFill?l.paint.sectorFill(n[0][0],n[0][1],i,t[0],t[1],e):l.paint.sector(n[0][0],n[0][1],i,t[0],t[1],e,u)}}},l.setShape(e)},Image:function(e,t){t=t||this,e=e||{},myst.compose(t,new a.Control(e,t),new o.Graphics(e,t)),t._type="Image"},TileImage:function(e,t){},Label:function(e,t){t=t||this,e=e||{},myst.compose(t,new a.Control(e,t)),t._type="Label",t._autoResize=n(e.autoResize,!1),t._text=n(e.text,""),t.setText=function(e){},t._events.onRepaint=function(){},t.setText(e.text)},LinkLabel:function(e,t){},BitmapLabel:function(e,t){t=t||this,e=e||{},myst.compose(t,new a.Control(e,t)),t._type="BitmapLabel"},TileButton:function(e,t){t=t||this,e=e||{},myst.compose(t,new a.Control(e,t),new o.Tile(e,t),new o.AbstractButton(e,t)),t._type="TileButton",e.tiles=e.tiles||{};var n=e.tiles.normal||[0,0],i=e.tiles.pressed||[0,0],r=e.tiles.disabled||[0,0];t._events.onPress=function(){t._activeTile=i,t._requestRepaint=!0,c(e.onPress,t)},t._events.onRelease=function(){t._activeTile=n,t._requestRepaint=!0,c(e.onRelease,t)},t._events.onClick=function(){c(e.onClick,t)},t._events.onEnabled=function(){t._activeTile=n,t._requestRepaint=!0,c(e.onEnabled,t)},t._events.onDisabled=function(){t._activeTile=r,t._requestRepaint=!0,c(e.onDisabled,t)}},GraphicButton:function(){},ToggleButton:function(){},StateBox:function(){},CheckBox:function(){},OptionBox:function(){}},s={init:function(e){i=e},createTile:function(e,t,n,i,r){var o=new myst.Surface({width:i,height:r});return o.render.tile(e,0,0,i,r,t,n),o.canvas},setGlobalContext:function(e){t=e}};return myst.compose({atomic:o},a,s)}();